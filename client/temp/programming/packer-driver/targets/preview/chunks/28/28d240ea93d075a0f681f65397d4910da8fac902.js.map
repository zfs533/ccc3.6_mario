{"version":3,"sources":["file:///E:/CocosCreator/mario/ccc3.6_mario/client/assets/script/framework/localConfig.ts"],"names":["resources","_decorator","CSVManager","resourceUtil","ccclass","property","localConfig","csvManager","arrCars","_callback","_skills","currentLoad","cntLoad","servers","instance","_instance","loadConfig","cb","loadCSV","loadDir","err","assets","console","log","length","forEach","item","index","array","getData","name","content","addTable","tryToCallbackOnFinished","queryOne","tableName","key","value","queryByID","ID","getTable","getTableArr","queryAll","queryIn","values","queryByCondition","condition"],"mappings":"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","sourcesContent":["import { resources } from 'cc';\r\nimport { _decorator, Component } from \"cc\";\r\nimport { CSVManager } from \"./csvManager\";\r\nimport { resourceUtil } from \"./resourceUtil\";\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass(\"localConfig\")\r\nexport class localConfig {\r\n    /* class member could be defined like this */\r\n    static _instance: localConfig;\r\n    csvManager: CSVManager;\r\n    arrCars: [any];\r\n\r\n    static get instance() {\r\n        if (this._instance) {\r\n            return this._instance;\r\n        }\r\n\r\n        this._instance = new localConfig();\r\n        return this._instance;\r\n    }\r\n\r\n    _callback: Function = null;\r\n    _skills: any = {};\r\n    currentLoad: number = 0;\r\n    cntLoad: number = 0;\r\n    servers: any = [];\r\n\r\n    loadConfig(cb: Function) {\r\n        this._callback = cb;\r\n        this.csvManager = new CSVManager();\r\n        this.loadCSV();\r\n    }\r\n\r\n    loadCSV() {\r\n        //新增数据表 请往该数组中添加....\r\n        resources.loadDir(\"datas\", (err: any, assets) => {\r\n            if (err) {\r\n                console.log(err);\r\n                return;\r\n            }\r\n            //+1主要是后续还有技能配置的加载，特殊处理\r\n            this.cntLoad = assets.length;\r\n            //客户端加载\r\n            assets.forEach((item, index, array) => {\r\n                resourceUtil.getData(item.name, (err: any, content: any) => {\r\n                    this.csvManager.addTable(item.name, content);\r\n                    this.tryToCallbackOnFinished();\r\n                });\r\n            });\r\n        })\r\n    }\r\n\r\n    queryOne(tableName: string, key: string, value: any) {\r\n        return this.csvManager.queryOne(tableName, key, value);\r\n    }\r\n\r\n    queryByID(tableName: string, ID: string) {\r\n        return this.csvManager.queryByID(tableName, ID);\r\n    }\r\n\r\n    getTable(tableName: string) {\r\n        return this.csvManager.getTable(tableName);\r\n    }\r\n\r\n    getTableArr(tableName: string) {\r\n        return this.csvManager.getTableArr(tableName);\r\n    }\r\n\r\n    // 选出指定表里面所有有 key=>value 键值对的数据\r\n    queryAll(tableName: string, key: string, value: any) {\r\n        return this.csvManager.queryAll(tableName, key, value);\r\n    }\r\n\r\n    // 选出指定表里所有 key 的值在 values 数组中的数据，返回 Object，key 为 ID\r\n    queryIn(tableName: string, key: string, values: Array<any>) {\r\n        return this.csvManager.queryIn(tableName, key, values);\r\n    }\r\n\r\n    // 选出符合条件的数据。condition key 为表格的key，value 为值的数组。返回的object，key 为数据在表格的ID，value为具体数据\r\n    queryByCondition(tableName: string, condition: any) {\r\n        return this.csvManager.queryByCondition(tableName, condition);\r\n    }\r\n\r\n    tryToCallbackOnFinished() {\r\n        if (this._callback) {\r\n            this.currentLoad++;\r\n            if (this.currentLoad >= this.cntLoad) {\r\n                this._callback();\r\n            }\r\n        }\r\n    }\r\n}\r\n"]}