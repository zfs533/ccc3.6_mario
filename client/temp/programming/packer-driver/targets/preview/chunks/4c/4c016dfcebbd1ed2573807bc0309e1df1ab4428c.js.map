{"version":3,"sources":["file:///E:/CocosCreator/git/mario/client/assets/script/game/roles/roleManager.ts"],"names":["_decorator","instantiate","Vec3","cfgLevel","clientEvent","Constant","RoleEnum","resourceUtil","ccclass","property","roleManager","_map","_initRolePos","_initEnemyPos","bigLevel","smallLevel","sonLevel","level_data","alivePoint","Inst","_instance","init","map","addMarioToMap","data","reLifePos","loadRole","mario","dispatchEvent","EVENT_TYPE","InitCameraPos","addEnemyToMap","enemyBlack","name","pos","pre","loadPiecesPriefabRes","node","addChild","setPosition","updateAlivePoint","rolePos","posCfg","i","length","x"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAA6BC,MAAAA,W,OAAAA,W;AAAaC,MAAAA,I,OAAAA,I;;AAC5CC,MAAAA,Q;;AAEEC,MAAAA,W,iBAAAA,W;;AACAC,MAAAA,Q,iBAAAA,Q;;AACAC,MAAAA,Q,iBAAAA,Q;;AACAC,MAAAA,Y,iBAAAA,Y;;;;;;;;;OAEH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBT,U;;6BAGjBU,W,WADZF,OAAO,CAAC,aAAD,C,2BAAR,MACaE,WADb,CACyB;AAAA;AAAA,eACbC,IADa;AAAA,eAEbC,YAFa,GAEE,IAAIV,IAAJ,EAFF;AAAA,eAGbW,aAHa,GAGG,IAAIX,IAAJ,CAAS,IAAT,EAAe,IAAf,EAAqB,CAArB,CAHH;AAAA,eAKdY,QALc,GAKI,GALJ;AAAA,eAMdC,UANc,GAMM,GANN;AAAA,eAOdC,QAPc,GAOI,CAPJ;AAAA,eAQdC,UARc,GAQD,IARC;AAAA,eASdC,UATc,GASM,CATN;AAAA;;AAUC,mBAAJC,IAAI,GAAgB;AAClC,cAAI,CAAC,KAAKC,SAAV,EAAqB;AACjB,iBAAKA,SAAL,GAAiB,IAAIV,WAAJ,EAAjB;AACH;;AACD,iBAAO,KAAKU,SAAZ;AACH;;AACMC,QAAAA,IAAI,CAACC,GAAD,EAAW;AAClB,eAAKX,IAAL,GAAYW,GAAZ;AACH;AAED;AACJ;AACA;;;AACWC,QAAAA,aAAa,GAAG;AACnB,eAAKN,UAAL,GAAkB;AAAA;AAAA,oCAASO,IAAT,CAAc,KAAKV,QAAnB,EAA6B,KAAKC,UAAlC,EAA8C,KAAKC,QAAnD,CAAlB;AACA,eAAKJ,YAAL,GAAoB,KAAKK,UAAL,CAAgBQ,SAAhB,CAA0B,KAAKP,UAA/B,CAApB;AACA,eAAKQ,QAAL,CAAc;AAAA;AAAA,oCAASC,KAAvB,EAA8B,KAAKf,YAAnC;AACA;AAAA;AAAA,0CAAYgB,aAAZ,CAA0B;AAAA;AAAA,oCAASC,UAAT,CAAoBC,aAA9C,EAA4D,KAAKlB,YAAjE;AACH;AAED;AACJ;AACA;;;AACWmB,QAAAA,aAAa,GAAG;AACnB,eAAKL,QAAL,CAAc;AAAA;AAAA,oCAASM,UAAvB,EAAmC,KAAKnB,aAAxC;AACH;AAED;AACJ;AACA;AACA;AACA;;;AACkBa,QAAAA,QAAQ,CAACO,IAAD,EAAeC,GAAf,EAA0B;AAAA;;AAAA;AAC5C,gBAAIC,GAAG,SAAS;AAAA;AAAA,8CAAaC,oBAAb,CAAkCH,IAAlC,CAAhB;;AACA,gBAAIE,GAAJ,EAAS;AACL;AACA,kBAAIE,IAAI,GAAGpC,WAAW,CAACkC,GAAD,CAAtB;AACAE,cAAAA,IAAI,CAACJ,IAAL,GAAYA,IAAZ;;AACA,cAAA,KAAI,CAACtB,IAAL,CAAU0B,IAAV,CAAeC,QAAf,CAAwBD,IAAxB;;AACAA,cAAAA,IAAI,CAACE,WAAL,CAAiBL,GAAjB;AACH;AAR2C;AAS/C;;AAEMM,QAAAA,gBAAgB,CAACC,OAAD,EAAc;AACjC,cAAIC,MAAM,GAAG,KAAKzB,UAAL,CAAgBQ,SAA7B;;AACA,eAAI,IAAIkB,CAAC,GAAG,CAAZ,EAAeA,CAAC,GAAED,MAAM,CAACE,MAAzB,EAAgCD,CAAC,EAAjC,EAAoC;AAChC,gBAAGF,OAAO,CAACI,CAAR,GAAUH,MAAM,CAACC,CAAD,CAAN,CAAUE,CAAvB,EAAyB;AACrB,mBAAK3B,UAAL,GAAkByB,CAAlB;AACH;AACJ;AACJ;;AA5DoB,O,UAINvB,S","sourcesContent":["import { _decorator, Component, Node, instantiate, Vec3 } from 'cc';\r\nimport cfgLevel from '../../config/cfgLevel';\r\nimport { lifePoint } from '../../config/lifePoint';\r\nimport { clientEvent } from '../../framework/clientEvent';\r\nimport { Constant } from '../../framework/constant';\r\nimport { RoleEnum } from '../../framework/enum';\r\nimport { resourceUtil } from '../../framework/resourceUtil';\r\nimport { map } from '../ui/map/map';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('roleManager')\r\nexport class roleManager {\r\n    private _map: map;\r\n    private _initRolePos = new Vec3();//角色初始化默认位置\r\n    private _initEnemyPos = new Vec3(1000, 20.5, 0);//角色初始化默认位置\r\n    private static _instance: roleManager;\r\n    public bigLevel:string = \"1\";   //大关卡\r\n    public smallLevel:string = \"1\"; //小关卡\r\n    public sonLevel:number = 0;     //小关卡中的关卡\r\n    public level_data = null;\r\n    public alivePoint:number = 0;\r\n    public static get Inst(): roleManager {\r\n        if (!this._instance) {\r\n            this._instance = new roleManager();\r\n        }\r\n        return this._instance;\r\n    }\r\n    public init(map: map) {\r\n        this._map = map;\r\n    }\r\n\r\n    /**\r\n     * 加载mario到场景地图中\r\n     */\r\n    public addMarioToMap() {\r\n        this.level_data = cfgLevel.data[this.bigLevel][this.smallLevel][this.sonLevel];\r\n        this._initRolePos = this.level_data.reLifePos[this.alivePoint];\r\n        this.loadRole(RoleEnum.mario, this._initRolePos);\r\n        clientEvent.dispatchEvent(Constant.EVENT_TYPE.InitCameraPos,this._initRolePos);\r\n    }\r\n\r\n    /**\r\n     * 加载monster到场景地图中\r\n     */\r\n    public addEnemyToMap() {\r\n        this.loadRole(RoleEnum.enemyBlack, this._initEnemyPos);\r\n    }\r\n\r\n    /**\r\n     * 动态加载角色\r\n     * @param name \r\n     * @param pos \r\n     */\r\n    private async loadRole(name: string, pos: Vec3) {\r\n        let pre = await resourceUtil.loadPiecesPriefabRes(name)\r\n        if (pre) {\r\n            //加载金币并发送消除金币事件\r\n            let node = instantiate(pre) as Node;\r\n            node.name = name;\r\n            this._map.node.addChild(node);\r\n            node.setPosition(pos);\r\n        }\r\n    }\r\n\r\n    public updateAlivePoint(rolePos:Vec3){\r\n        let posCfg = this.level_data.reLifePos;\r\n        for(let i = 0 ;i <posCfg.length;i++){\r\n            if(rolePos.x>posCfg[i].x){\r\n                this.alivePoint = i;\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n"]}