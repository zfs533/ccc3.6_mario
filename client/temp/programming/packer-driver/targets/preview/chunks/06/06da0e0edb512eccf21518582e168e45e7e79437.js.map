{"version":3,"sources":["file:///E:/CocosCreator/git/mario/client/assets/script/game/roles/mario/mario.ts"],"names":["Animation","PolygonCollider2D","RigidBody2D","tween","UITransform","v2","v3","Vec3","_decorator","clientEvent","Constant","AnimMario","EnumPhysicsGroup","MarioBodyStatus","MarioStatus","baseCollider","brick","whyBrick","roleManager","ccclass","property","mario","_anim","undefined","_rigidbody2d","_speed","_speedHalf","_isMoving","_jumpPoint","_status","_isDeath","_lastColliderName","_scale1","_scale2","start","_init","_addListener","setPhysicsGroup","on","EVENT_TYPE","Move","_evtStartMove","Stop","_evtStop","Jump","_evtJump","MarioDeath","_evtPlayMarioDeath","ChangeStatus","_evtChangeStatus","onDestroy","off","MoveSpeed","_loadAnimComponent","_loadRigidBody2d","playIdle","Promise","resolve","node","getComponent","update","deltaTime","CurMap","physicsStatus","pos","getPosition","speed","x","CurMapWidth","setPosition","scale","getScale","gap","Math","abs","setOwnScale","dispatchEvent","MoveCamera","y","jump","playWalk","finish","idle","walk","_isCandoAction","play","isDown","destroy","death","z","applyForce","Inst","updateAlivePoint","scheduleOnce","TranslateScenes","playSwim","swim","playJump","status","handleColliderUp","onBeginContact","selfCollider","otherCollider","contact","name1","name","name2","includes","nextLevel","FinishedGame","_check_gameOver","bk","points","getWorldManifold","length","cPos","bPos","getWorldPosition","BrickMove","index","TopWhy","ut","height","handleMushroom","EnablePhysics","BodyStatus","normal","MushRoomDestroy","scalex1","scalex2","scalex3","scalex4","scalex5","scaley1","scaley2","scaley3","scaley4","scaley5","to","call","console","log","huge","setScale"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,S,OAAAA,S;AAAoEC,MAAAA,iB,OAAAA,iB;AAAmBC,MAAAA,W,OAAAA,W;AAAaC,MAAAA,K,OAAAA,K;AAAOC,MAAAA,W,OAAAA,W;AAAaC,MAAAA,E,OAAAA,E;AAAIC,MAAAA,E,OAAAA,E;AAAIC,MAAAA,I,OAAAA,I;AAAMC,MAAAA,U,OAAAA,U;;AACtIC,MAAAA,W,iBAAAA,W;;AACAC,MAAAA,Q,iBAAAA,Q;;AACAC,MAAAA,S,iBAAAA,S;AAAWC,MAAAA,gB,iBAAAA,gB;AAAkBC,MAAAA,e,iBAAAA,e;AAAiBC,MAAAA,W,iBAAAA,W;;AAC9CC,MAAAA,Y,iBAAAA,Y;;AACAC,MAAAA,K,iBAAAA,K;;AAEAC,MAAAA,Q,iBAAAA,Q;;AACAC,MAAAA,W,iBAAAA,W;;;;;;;;;OACH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBZ,U;;uBAGjBa,K,WADZF,OAAO,CAAC,OAAD,C,gBAAR,MACaE,KADb;AAAA;AAAA,wCACwC;AAAA;AAAA;AAAA,eAC5BC,KAD4B,GACTC,SADS;AAAA,eAE5BC,YAF4B,GAEAD,SAFA;AAAA,eAG5BE,MAH4B,GAGX,CAAC,CAHU;AAAA,eAI5BC,UAJ4B,GAIP,GAJO;AAAA,eAK5BC,SAL4B,GAKP,KALO;AAAA,eAM5BC,UAN4B,GAMT,IAAIrB,IAAJ,EANS;AAAA,eAO5BsB,OAP4B,GAOV,CAPU;AAAA,eAQ5BC,QAR4B,GAQR,KARQ;AAAA,eAS5BC,iBAT4B,GASD,EATC;AAAA,eAU5BC,OAV4B,GAUX,GAVW;AAAA,eAW5BC,OAX4B,GAWX,CAXW;AAAA;;AAYpCC,QAAAA,KAAK,GAAG;AACJ,gBAAMA,KAAN;;AACA,eAAKC,KAAL;;AACA,eAAKC,YAAL;;AACA,eAAKC,eAAL,CAAqB;AAAA;AAAA,oDAAiBhB,KAAtC;AACH;;AAEOe,QAAAA,YAAY,GAAG;AACnB;AAAA;AAAA,0CAAYE,EAAZ,CAAe;AAAA;AAAA,oCAASC,UAAT,CAAoBC,IAAnC,EAAyC,KAAKC,aAA9C,EAA6D,IAA7D;AACA;AAAA;AAAA,0CAAYH,EAAZ,CAAe;AAAA;AAAA,oCAASC,UAAT,CAAoBG,IAAnC,EAAyC,KAAKC,QAA9C,EAAwD,IAAxD;AACA;AAAA;AAAA,0CAAYL,EAAZ,CAAe;AAAA;AAAA,oCAASC,UAAT,CAAoBK,IAAnC,EAAyC,KAAKC,QAA9C,EAAwD,IAAxD;AACA;AAAA;AAAA,0CAAYP,EAAZ,CAAe;AAAA;AAAA,oCAASC,UAAT,CAAoBO,UAAnC,EAA+C,KAAKC,kBAApD,EAAwE,IAAxE;AACA;AAAA;AAAA,0CAAYT,EAAZ,CAAe;AAAA;AAAA,oCAASC,UAAT,CAAoBS,YAAnC,EAAiD,KAAKC,gBAAtD,EAAwE,IAAxE;AACH;;AAEDC,QAAAA,SAAS,GAAG;AACR;AAAA;AAAA,0CAAYC,GAAZ,CAAgB;AAAA;AAAA,oCAASZ,UAAT,CAAoBC,IAApC,EAA0C,KAAKC,aAA/C,EAA8D,IAA9D;AACA;AAAA;AAAA,0CAAYU,GAAZ,CAAgB;AAAA;AAAA,oCAASZ,UAAT,CAAoBG,IAApC,EAA0C,KAAKC,QAA/C,EAAyD,IAAzD;AACA;AAAA;AAAA,0CAAYQ,GAAZ,CAAgB;AAAA;AAAA,oCAASZ,UAAT,CAAoBK,IAApC,EAA0C,KAAKC,QAA/C,EAAyD,IAAzD;AACA;AAAA;AAAA,0CAAYM,GAAZ,CAAgB;AAAA;AAAA,oCAASZ,UAAT,CAAoBO,UAApC,EAAgD,KAAKC,kBAArD,EAAyE,IAAzE;AACA;AAAA;AAAA,0CAAYI,GAAZ,CAAgB;AAAA;AAAA,oCAASZ,UAAT,CAAoBS,YAApC,EAAkD,KAAKC,gBAAvD,EAAyE,IAAzE;AACH;;AAEOd,QAAAA,KAAK,GAAG;AACZ,eAAKV,MAAL,GAAc;AAAA;AAAA,oCAAS2B,SAAT,GAAqB,CAAnC;;AACA,eAAKC,kBAAL;;AACA,eAAKC,gBAAL;;AACA,eAAKC,QAAL;AACH;;AACOF,QAAAA,kBAAkB,GAAG;AACzB,iBAAO,IAAIG,OAAJ,CAAYC,OAAO,IAAI;AAC1B,iBAAKnC,KAAL,GAAa,KAAKoC,IAAL,CAAUC,YAAV,CAAuB3D,SAAvB,CAAb;AACAyD,YAAAA,OAAO,CAAC,IAAD,CAAP;AACH,WAHM,CAAP;AAIH;;AACOH,QAAAA,gBAAgB,GAAG;AACvB,iBAAO,IAAIE,OAAJ,CAAYC,OAAO,IAAI;AAC1B,iBAAKjC,YAAL,GAAoB,KAAKkC,IAAL,CAAUC,YAAV,CAAuBzD,WAAvB,CAApB;AACAuD,YAAAA,OAAO,CAAC,IAAD,CAAP;AACH,WAHM,CAAP;AAIH;;AAEDG,QAAAA,MAAM,CAACC,SAAD,EAAoB;AACtB,cAAI,KAAK/B,QAAL,IAAiB,CAAC;AAAA;AAAA,oCAASgC,MAAT,CAAgBC,aAAtC,EAAqD;;AACrD,cAAG,KAAKpC,SAAR,EAAkB;AACd,gBAAIqC,IAAG,GAAG,KAAKN,IAAL,CAAUO,WAAV,EAAV;;AACA,gBAAIC,KAAK,GAAGL,SAAS,GAAC,KAAKpC,MAAf,GAAsB,GAAlC;AACAuC,YAAAA,IAAG,CAACG,CAAJ,IAASD,KAAT;;AACA,gBAAIF,IAAG,CAACG,CAAJ,IAAS,CAAb,EAAgB;AAAEH,cAAAA,IAAG,CAACG,CAAJ,GAAQ,CAAR;AAAY;;AAC9B,gBAAGH,IAAG,CAACG,CAAJ,IAAO;AAAA;AAAA,sCAASC,WAAT,GAAuB,CAAjC,EAAmC;AAACJ,cAAAA,IAAG,CAACG,CAAJ,GAAQ;AAAA;AAAA,wCAASC,WAAT,GAAuB,CAA/B;AAAkC;;AACtE,iBAAKV,IAAL,CAAUW,WAAV,CAAsBL,IAAtB;AACA,gBAAIM,KAAK,GAAG,KAAKZ,IAAL,CAAUa,QAAV,EAAZ;AACA,gBAAIC,GAAG,GAAG,KAAK/C,MAAL,GAAc,CAAd,GAAkB,CAAlB,GAAsB,CAAC,CAAjC;AACA6C,YAAAA,KAAK,CAACH,CAAN,GAAUK,GAAG,GAACC,IAAI,CAACC,GAAL,CAASJ,KAAK,CAACH,CAAf,CAAd,CATc,CAUd;;AACA,iBAAKQ,WAAL,CAAiBL,KAAjB;AACA;AAAA;AAAA,4CAAYM,aAAZ,CAA0B;AAAA;AAAA,sCAASrC,UAAT,CAAoBsC,UAA9C,EAA0D,CAACb,IAAD,EAAME,KAAN,CAA1D;AACH;;AAED,cAAIF,GAAG,GAAG,KAAKN,IAAL,CAAUO,WAAV,EAAV;;AACA,cAAID,GAAG,CAACc,CAAJ,GAAQ,CAAC,EAAb,EAAiB;AACb,iBAAK/B,kBAAL,CAAwB,IAAxB;;AACA;AACH;;AAED,kBAAO,KAAKlB,OAAZ;AACI,iBAAK;AAAA;AAAA,4CAAYkD,IAAjB;AACI;AACA;AACA,kBAAGN,IAAI,CAACC,GAAL,CAASV,GAAG,CAACc,CAAJ,GAAQ,KAAKlD,UAAL,CAAgBkD,CAAjC,IAAoC,CAAvC,EAAyC;AACrC,oBAAG,KAAKnD,SAAR,EAAkB;AACd,uBAAKqD,QAAL;AACH,iBAFD,MAGI;AACA,uBAAKzB,QAAL;AACH;AACJ;;AACD;;AAEJ,iBAAK;AAAA;AAAA,4CAAY0B,MAAjB;AACI,mBAAKxD,MAAL,GAAc,KAAKC,UAAnB;AACA;;AAEJ,iBAAK;AAAA;AAAA,4CAAYwD,IAAjB;AACI,mBAAK3B,QAAL;AACA;;AAEJ,iBAAK;AAAA;AAAA,4CAAY4B,IAAjB;AAEI;;AACJ;AAAQ;AAzBZ;AA2BH;;AAEK5B,QAAAA,QAAQ,GAAG;AAAA;;AAAA;AACb,gBAAI,CAAC,KAAI,CAACjC,KAAV,EAAiB;AACb,oBAAM,KAAI,CAAC+B,kBAAL,EAAN;AACH;;AACD,gBAAG,CAAC,KAAI,CAAC+B,cAAL,CAAoB;AAAA;AAAA,4CAAYF,IAAhC,CAAJ,EAA0C;;AAC1C,YAAA,KAAI,CAAC5D,KAAL,CAAW+D,IAAX,CAAgB;AAAA;AAAA,wCAAUH,IAA1B;AALa;AAMhB;;AACKF,QAAAA,QAAQ,GAAG;AAAA;;AAAA;AACb,gBAAI,CAAC,MAAI,CAAC1D,KAAV,EAAiB;AACb,oBAAM,MAAI,CAAC+B,kBAAL,EAAN;AACH;;AACD,gBAAG,CAAC,MAAI,CAAC+B,cAAL,CAAoB;AAAA;AAAA,4CAAYD,IAAhC,CAAJ,EAA0C;;AAC1C,YAAA,MAAI,CAAC7D,KAAL,CAAW+D,IAAX,CAAgB;AAAA;AAAA,wCAAUF,IAA1B;AALa;AAMhB;;AACKpC,QAAAA,kBAAkB,CAACuC,MAAD,EAA0B;AAAA;;AAAA;AAAA,gBAAzBA,MAAyB;AAAzBA,cAAAA,MAAyB,GAAP,KAAO;AAAA;;AAC9C,gBAAI,MAAI,CAACxD,QAAT,EAAmB;;AACnB,gBAAI,CAAC,MAAI,CAACR,KAAV,EAAiB;AACb,oBAAM,MAAI,CAAC+B,kBAAL,EAAN;AACH;;AACD,YAAA,MAAI,CAACK,IAAL,CAAUC,YAAV,CAAuB1D,iBAAvB,EAA0CsF,OAA1C;;AACA,YAAA,MAAI,CAAC1D,OAAL,GAAe;AAAA;AAAA,4CAAY2D,KAA3B;;AACA,YAAA,MAAI,CAAClE,KAAL,CAAW+D,IAAX,CAAgB;AAAA;AAAA,wCAAUG,KAA1B;;AACA,YAAA,MAAI,CAAC1D,QAAL,GAAgB,IAAhB;;AACA,gBAAIkC,GAAG,GAAG,MAAI,CAACN,IAAL,CAAUO,WAAV,EAAV;;AACA,YAAA,MAAI,CAACP,IAAL,CAAUW,WAAV,CAAsB/D,EAAE,CAAC0D,GAAG,CAACG,CAAL,EAAQH,GAAG,CAACc,CAAJ,GAAQ,CAAhB,EAAmBd,GAAG,CAACyB,CAAvB,CAAxB;;AACA,gBAAIH,MAAJ,EAAY;AACR,cAAA,MAAI,CAAC9D,YAAL,CAAkBkE,UAAlB,CAA6BrF,EAAE,CAAC,CAAD,EAAI,IAAJ,CAA/B,EAA0CA,EAAE,CAAC,CAAD,EAAI,CAAJ,CAA5C,EAAoD,IAApD;AACH,aAFD,MAGK;AACD,cAAA,MAAI,CAACmB,YAAL,CAAkBkE,UAAlB,CAA6BrF,EAAE,CAAC,CAAD,EAAI,IAAJ,CAA/B,EAA0CA,EAAE,CAAC,CAAD,EAAI,CAAJ,CAA5C,EAAoD,IAApD;AACH,aAhB6C,CAiB9C;;;AACA;AAAA;AAAA,4CAAYsF,IAAZ,CAAiBC,gBAAjB,CAAkC5B,GAAlC,EAlB8C,CAmB9C;;AACA,YAAA,MAAI,CAAC6B,YAAL,CAAkB,MAAM;AACpB,cAAA,MAAI,CAACnC,IAAL,CAAU6B,OAAV;;AACA;AAAA;AAAA,8CAAYX,aAAZ,CAA0B;AAAA;AAAA,wCAASrC,UAAT,CAAoBuD,eAA9C;AACH,aAHD,EAGG,CAHH;AApB8C;AAwBjD;;AACKC,QAAAA,QAAQ,GAAG;AAAA;;AAAA;AACb,gBAAI,CAAC,MAAI,CAACzE,KAAV,EAAiB;AACb,oBAAM,MAAI,CAAC+B,kBAAL,EAAN;AACH;;AACD,gBAAG,CAAC,MAAI,CAAC+B,cAAL,CAAoB;AAAA;AAAA,4CAAYY,IAAhC,CAAJ,EAA0C;;AAC1C,YAAA,MAAI,CAAC1E,KAAL,CAAW+D,IAAX,CAAgB;AAAA;AAAA,wCAAUW,IAA1B;AALa;AAMhB;;AAEKC,QAAAA,QAAQ,GAAG;AAAA;;AAAA;AACb,gBAAI,CAAC,MAAI,CAAC3E,KAAV,EAAiB;AACb,oBAAM,MAAI,CAAC+B,kBAAL,EAAN;AACH;;AACD,gBAAIW,GAAG,GAAG,MAAI,CAACN,IAAL,CAAUO,WAAV,EAAV;;AACA,YAAA,MAAI,CAACrC,UAAL,GAAkBtB,EAAE,CAAC0D,GAAG,CAACG,CAAL,EAAOH,GAAG,CAACc,CAAX,EAAad,GAAG,CAACyB,CAAjB,CAApB;AACAzB,YAAAA,GAAG,CAACc,CAAJ,IAAO,CAAP;;AACA,YAAA,MAAI,CAACpB,IAAL,CAAUW,WAAV,CAAsBL,GAAtB;;AACA,gBAAG,CAAC,MAAI,CAACoB,cAAL,CAAoB;AAAA;AAAA,4CAAYL,IAAhC,CAAJ,EAA0C;;AAC1C,YAAA,MAAI,CAACzD,KAAL,CAAW+D,IAAX,CAAgB;AAAA;AAAA,wCAAUN,IAA1B;;AACA,YAAA,MAAI,CAACvD,YAAL,CAAkBkE,UAAlB,CAA6BrF,EAAE,CAAC,CAAD,EAAI,GAAJ,CAA/B,EAAyCA,EAAE,CAAC,CAAD,EAAI,CAAJ,CAA3C,EAAmD,IAAnD;AAVa;AAWhB;AAED;AACJ;AACA;AACA;AACA;;;AACY+E,QAAAA,cAAc,CAACc,MAAD,EAA4B;AAC9C,cAAG,KAAKpE,QAAR,EAAkB,OAAO,KAAP;AAClB,cAAG,KAAKD,OAAL,IAAgB;AAAA;AAAA,0CAAY2D,KAA/B,EAAsC,OAAO,KAAP;AACtC,cAAG,KAAK3D,OAAL,IAAgBqE,MAAnB,EAA2B,OAAO,KAAP;AAC3B,eAAKrE,OAAL,GAAeqE,MAAf;AACA,iBAAO,IAAP;AACH;AAED;AACJ;AACA;AACA;;;AACYzD,QAAAA,aAAa,CAACuB,GAAD,EAAY;AAC7B,cAAI,CAAC,KAAKrC,SAAN,IAAmB,KAAKE,OAAL,IAAgB;AAAA;AAAA,0CAAYsD,IAAnD,EAAyD;AACrD,gBAAG,KAAKtD,OAAL,IAAgB;AAAA;AAAA,4CAAYkD,IAA/B,EAAoC;AAChC,mBAAKC,QAAL;AACH;AACJ;;AACD,eAAKrD,SAAL,GAAiB,IAAjB;AACA,eAAKF,MAAL,GAAcuC,GAAG,CAACG,CAAJ,GAAQ,CAAR,GAAY,CAAC,CAAb,GAAgB,CAA9B;AACH;;AACOxB,QAAAA,QAAQ,GAAG;AACf,eAAKhB,SAAL,GAAiB,KAAjB;AACA,eAAK4B,QAAL;AACH;AAED;AACJ;AACA;;;AACkBV,QAAAA,QAAQ,GAAG;AAAA;;AAAA;AACrB,gBAAI,CAAC,MAAI,CAACrB,YAAV,EAAwB;AACpB,oBAAM,MAAI,CAAC8B,gBAAL,EAAN;AACH;;AACD,gBAAI,MAAI,CAACzB,OAAL,IAAgB;AAAA;AAAA,4CAAYkD,IAAhC,EAAsC;AAClC;AACH;;AACD,YAAA,MAAI,CAACkB,QAAL;AAPqB;AAQxB;AAED;AACJ;AACA;;;AACIE,QAAAA,gBAAgB,GAAG;AACf,cAAI,KAAKxE,SAAT,EAAoB;AAChB,iBAAKqD,QAAL;AACH,WAFD,MAGK;AACD,iBAAKzB,QAAL;AACH;AACJ;AAED;AACJ;AACA;AACA;AACA;AACA;;;AACW6C,QAAAA,cAAc,CAACC,YAAD,EAA2BC,aAA3B,EAAsDC,OAAtD,EAAyF;AAC1G;AACA,cAAIC,KAAK,GAAGH,YAAY,CAAC3C,IAAb,CAAkB+C,IAA9B;AACA,cAAIC,KAAK,GAAGJ,aAAa,CAAC5C,IAAd,CAAmB+C,IAA/B;AACA,cAAGC,KAAK,IAAI,KAAK3E,iBAAd,IAAmC,CAAC;AAAA;AAAA,oCAAS+B,MAAT,CAAgBC,aAAvD,EAAqE;AACrE,eAAKhC,iBAAL,GAAyB2E,KAAzB;;AACA,cAAG,KAAK7E,OAAL,IAAgB;AAAA;AAAA,0CAAYkD,IAA/B,EAAoC;AAChC,iBAAKoB,gBAAL,GADgC,CACR;AAC3B;;AACD,cAAGO,KAAK,CAACC,QAAN,CAAe,OAAf,CAAH,EAA2B;AACvB;AAAA;AAAA,4CAAYhB,IAAZ,CAAiBiB,SAAjB;AACH;;AACD,cAAG;AAAA;AAAA,oCAASC,YAAZ,EAAyB;;AACzB,cAAGH,KAAK,CAACC,QAAN,CAAe,MAAf,CAAH,EAA0B;AACtB,iBAAKG,eAAL;AACH;;AAED,cAAIN,KAAK,CAACG,QAAN,CAAe,OAAf,KAA2BD,KAAK,CAACC,QAAN,CAAe,MAAf,CAA/B,EAAuD;AACnD,gBAAII,EAAS,GAAGT,aAAa,CAAC5C,IAAd,CAAmBC,YAAnB;AAAA;AAAA,+BAAhB;AACA,gBAAIqD,MAAM,GAAGT,OAAO,CAACU,gBAAR,GAA2BD,MAAxC;;AACA,gBAAID,EAAJ,EAAQ;AACJ,kBAAIC,MAAM,CAACE,MAAP,GAAgB,CAApB,EAAuB;AACnB,oBAAIC,IAAI,GAAGH,MAAM,CAAC,CAAD,CAAjB;AACA,oBAAII,IAAI,GAAGd,aAAa,CAAC5C,IAAd,CAAmB2D,gBAAnB,EAAX;;AACA,oBAAIF,IAAI,CAACrC,CAAL,IAAUsC,IAAI,CAACtC,CAAL,GAAS,CAAvB,EAA0B;AACtB;AAAA;AAAA,kDAAYF,aAAZ,CAA0B;AAAA;AAAA,4CAASrC,UAAT,CAAoB+E,SAApB,GAAgCP,EAAE,CAACQ,KAA7D,EAAoER,EAAE,CAACQ,KAAvE;AACH,iBAFD,MAGK,IAAIJ,IAAI,CAACrC,CAAL,IAAUsC,IAAI,CAACtC,CAAL,GAAS,CAAvB,EAA0B,CAC3B;AACA;AACH;AACJ;AACJ;AACJ,WAhBD,MAiBK,IAAI0B,KAAK,CAACG,QAAN,CAAe,OAAf,KAA2BD,KAAK,CAACC,QAAN,CAAe,YAAf,CAA/B,EAA6D;AAC9D,gBAAII,GAAY,GAAGT,aAAa,CAAC5C,IAAd,CAAmBC,YAAnB;AAAA;AAAA,qCAAnB;;AACA,gBAAIqD,OAAM,GAAGT,OAAO,CAACU,gBAAR,GAA2BD,MAAxC;;AACA,gBAAID,GAAJ,EAAQ;AACJ,kBAAIC,OAAM,CAACE,MAAP,GAAgB,CAApB,EAAuB;AACnB,oBAAIC,KAAI,GAAGH,OAAM,CAAC,CAAD,CAAjB;;AACA,oBAAII,KAAI,GAAGd,aAAa,CAAC5C,IAAd,CAAmB2D,gBAAnB,EAAX;;AACA,oBAAIF,KAAI,CAACrC,CAAL,IAAUsC,KAAI,CAACtC,CAAL,GAAS,CAAvB,EAA0B;AACtB;AAAA;AAAA,kDAAYF,aAAZ,CAA0B;AAAA;AAAA,4CAASrC,UAAT,CAAoBiF,MAApB,GAA6BT,GAAE,CAACQ,KAA1D,EAAiER,GAAE,CAACQ,KAApE;AACH,iBAFD,MAGK,IAAIJ,KAAI,CAACrC,CAAL,IAAUsC,KAAI,CAACtC,CAAL,GAAS,CAAvB,EAA0B,CAC9B;AACJ;AACJ;AACJ,WAdI,MAeA,IAAI0B,KAAK,CAACG,QAAN,CAAe,OAAf,KAA2BD,KAAK,CAACC,QAAN,CAAe,MAAf,CAA/B,EAAuD;AACxD,gBAAIc,EAAE,GAAGnB,aAAa,CAAC5C,IAAd,CAAmBC,YAAnB,CAAgCvD,WAAhC,CAAT;AACA,gBAAI4G,QAAM,GAAGT,OAAO,CAACU,gBAAR,GAA2BD,MAAxC;;AACA,gBAAIS,EAAJ,EAAQ;AACJ,kBAAIT,QAAM,CAACE,MAAP,GAAgB,CAApB,EAAuB;AACnB,oBAAIC,MAAI,GAAGH,QAAM,CAAC,CAAD,CAAjB;;AACA,oBAAII,MAAI,GAAGd,aAAa,CAAC5C,IAAd,CAAmB2D,gBAAnB,EAAX;;AACA,oBAAIF,MAAI,CAACrC,CAAL,IAAUsC,MAAI,CAACtC,CAAL,GAAS2C,EAAE,CAACC,MAAH,GAAY,CAAnC,EAAsC,CACrC;AACJ;AACJ;AACJ,WAXI,MAYA,IAAIlB,KAAK,CAACG,QAAN,CAAe,OAAf,KAA2BD,KAAK,CAACC,QAAN,CAAe,QAAf,CAA/B,EAAyD,CAC7D;;AACD,cAAGD,KAAK,CAACC,QAAN,CAAe,UAAf,CAAH,EAA8B;AAC1B,iBAAKgB,cAAL;AACH;AACJ;;AAEOA,QAAAA,cAAc,GAAE;AACpB;AAAA;AAAA,0CAAY/C,aAAZ,CAA0B;AAAA;AAAA,oCAASrC,UAAT,CAAoBqF,aAA9C,EAA4D,KAA5D;AACA,cAAItD,KAAK,GAAG,KAAKZ,IAAL,CAAUa,QAAV,EAAZ;;AACA,cAAG;AAAA;AAAA,oCAASsD,UAAT,IAAuB;AAAA;AAAA,kDAAgBC,MAA1C,EAAiD;AAAC;AAC9C;AAAA;AAAA,4CAAYlD,aAAZ,CAA0B;AAAA;AAAA,sCAASrC,UAAT,CAAoBwF,eAA9C;AACA,gBAAIC,OAAO,GAAG1D,KAAK,CAACH,CAAN,GAAQ,CAAR,GAAY,CAAZ,GAAgB,CAAC,CAA/B;AACA,gBAAI8D,OAAO,GAAG3D,KAAK,CAACH,CAAN,GAAQ,CAAR,GAAY,GAAZ,GAAkB,CAAC,GAAjC;AACA,gBAAI+D,OAAO,GAAG5D,KAAK,CAACH,CAAN,GAAQ,CAAR,GAAY,CAAZ,GAAgB,CAAC,CAA/B;AACA,gBAAIgE,OAAO,GAAG7D,KAAK,CAACH,CAAN,GAAQ,CAAR,GAAY,GAAZ,GAAkB,CAAC,GAAjC;AACA,gBAAIiE,OAAO,GAAG9D,KAAK,CAACH,CAAN,GAAQ,CAAR,GAAY,CAAZ,GAAgB,CAAC,CAA/B;AACA,gBAAIkE,OAAO,GAAG/D,KAAK,CAACQ,CAAN,GAAQ,CAAR,GAAY,CAAZ,GAAgB,CAAC,CAA/B;AACA,gBAAIwD,OAAO,GAAGhE,KAAK,CAACQ,CAAN,GAAQ,CAAR,GAAY,GAAZ,GAAkB,CAAC,GAAjC;AACA,gBAAIyD,OAAO,GAAGjE,KAAK,CAACQ,CAAN,GAAQ,CAAR,GAAY,CAAZ,GAAgB,CAAC,CAA/B;AACA,gBAAI0D,OAAO,GAAGlE,KAAK,CAACQ,CAAN,GAAQ,CAAR,GAAY,GAAZ,GAAkB,CAAC,GAAjC;AACA,gBAAI2D,OAAO,GAAGnE,KAAK,CAACQ,CAAN,GAAQ,CAAR,GAAY,CAAZ,GAAgB,CAAC,CAA/B;AACA3E,YAAAA,KAAK,CAAC,KAAKuD,IAAN,CAAL,CAAiBgF,EAAjB,CAAoB,GAApB,EAAwB;AAACpE,cAAAA,KAAK,EAAChE,EAAE,CAAC0H,OAAD,EAASK,OAAT,EAAiB/D,KAAK,CAACmB,CAAvB;AAAT,aAAxB,EACCiD,EADD,CACI,GADJ,EACQ;AAACpE,cAAAA,KAAK,EAAChE,EAAE,CAAC2H,OAAD,EAASK,OAAT,EAAiBhE,KAAK,CAACmB,CAAvB;AAAT,aADR,EAECiD,EAFD,CAEI,GAFJ,EAEQ;AAACpE,cAAAA,KAAK,EAAChE,EAAE,CAAC4H,OAAD,EAASK,OAAT,EAAiBjE,KAAK,CAACmB,CAAvB;AAAT,aAFR,EAGCiD,EAHD,CAGI,GAHJ,EAGQ;AAACpE,cAAAA,KAAK,EAAChE,EAAE,CAAC6H,OAAD,EAASK,OAAT,EAAiBlE,KAAK,CAACmB,CAAvB;AAAT,aAHR,EAICiD,EAJD,CAII,GAJJ,EAIQ;AAACpE,cAAAA,KAAK,EAAChE,EAAE,CAAC8H,OAAD,EAASK,OAAT,EAAiBnE,KAAK,CAACmB,CAAvB;AAAT,aAJR,EAKCkD,IALD,CAKM,MAAI;AACNC,cAAAA,OAAO,CAACC,GAAR,CAAY,UAAZ;AACA;AAAA;AAAA,8CAAYjE,aAAZ,CAA0B;AAAA;AAAA,wCAASrC,UAAT,CAAoBqF,aAA9C,EAA4D,IAA5D;AACA;AAAA;AAAA,wCAASC,UAAT,GAAsB;AAAA;AAAA,sDAAgBiB,IAAtC;AACH,aATD,EAUC5G,KAVD;AAWH;AACJ;;AAEO4E,QAAAA,eAAe,GAAE;AACrB;AAAA;AAAA,oCAASD,YAAT,GAAwB,IAAxB;AACA,eAAK7B,QAAL;AACA,eAAKnD,OAAL,GAAe;AAAA;AAAA,0CAAYoD,MAA3B;AACA;AAAA;AAAA,0CAAYL,aAAZ,CAA0B;AAAA;AAAA,oCAASrC,UAAT,CAAoBsE,YAA9C,EAJqB,CAKrB;AACA;AACA;AACA;AACA;AACA;AACA;AACH;;AAEO5D,QAAAA,gBAAgB,CAACiD,MAAD,EAAoB;AACxC,eAAKrE,OAAL,GAAeqE,MAAf;AACH;;AAEOvB,QAAAA,WAAW,CAACL,KAAD,EAAY;AAC3B,eAAKZ,IAAL,CAAUqF,QAAV,CAAmBzE,KAAnB;AACH;;AAzVmC,O","sourcesContent":["import { Animation, BoxCollider2D, Collider2D, Component, IPhysics2DContact, PolygonCollider2D, RigidBody2D, tween, UITransform, v2, v3, Vec3, _decorator } from 'cc';\r\nimport { clientEvent } from '../../../framework/clientEvent';\r\nimport { Constant } from '../../../framework/constant';\r\nimport { AnimMario, EnumPhysicsGroup, MarioBodyStatus, MarioStatus } from '../../../framework/enum';\r\nimport { baseCollider } from '../../collider/baseCollider';\r\nimport { brick } from '../../pieces/brick';\r\nimport { coin } from '../../pieces/coin';\r\nimport { whyBrick } from '../../pieces/whyBrick';\r\nimport { roleManager } from '../roleManager';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('mario')\r\nexport class mario extends baseCollider {\r\n    private _anim: Animation = undefined;\r\n    private _rigidbody2d: RigidBody2D = undefined;\r\n    private _speed: number = -1;\r\n    private _speedHalf: number = 0.5;\r\n    private _isMoving: boolean = false;\r\n    private _jumpPoint: Vec3 = new Vec3();\r\n    private _status: number = 0;\r\n    private _isDeath: boolean = false;\r\n    private _lastColliderName:string = \"\";\r\n    private _scale1:number = 2.5;\r\n    private _scale2:number = 5;\r\n    start() {\r\n        super.start();\r\n        this._init();\r\n        this._addListener();\r\n        this.setPhysicsGroup(EnumPhysicsGroup.mario)\r\n    }\r\n\r\n    private _addListener() {\r\n        clientEvent.on(Constant.EVENT_TYPE.Move, this._evtStartMove, this);\r\n        clientEvent.on(Constant.EVENT_TYPE.Stop, this._evtStop, this);\r\n        clientEvent.on(Constant.EVENT_TYPE.Jump, this._evtJump, this);\r\n        clientEvent.on(Constant.EVENT_TYPE.MarioDeath, this._evtPlayMarioDeath, this);\r\n        clientEvent.on(Constant.EVENT_TYPE.ChangeStatus, this._evtChangeStatus, this);\r\n    }\r\n\r\n    onDestroy() {\r\n        clientEvent.off(Constant.EVENT_TYPE.Move, this._evtStartMove, this);\r\n        clientEvent.off(Constant.EVENT_TYPE.Stop, this._evtStop, this);\r\n        clientEvent.off(Constant.EVENT_TYPE.Jump, this._evtJump, this);\r\n        clientEvent.off(Constant.EVENT_TYPE.MarioDeath, this._evtPlayMarioDeath, this);\r\n        clientEvent.off(Constant.EVENT_TYPE.ChangeStatus, this._evtChangeStatus, this);\r\n    }\r\n\r\n    private _init() {\r\n        this._speed = Constant.MoveSpeed / 2;\r\n        this._loadAnimComponent();\r\n        this._loadRigidBody2d();\r\n        this.playIdle();\r\n    }\r\n    private _loadAnimComponent() {\r\n        return new Promise(resolve => {\r\n            this._anim = this.node.getComponent(Animation);\r\n            resolve(null);\r\n        });\r\n    }\r\n    private _loadRigidBody2d() {\r\n        return new Promise(resolve => {\r\n            this._rigidbody2d = this.node.getComponent(RigidBody2D);\r\n            resolve(null);\r\n        });\r\n    }\r\n\r\n    update(deltaTime: number) {\r\n        if (this._isDeath || !Constant.CurMap.physicsStatus) return;\r\n        if(this._isMoving){\r\n            let pos = this.node.getPosition();\r\n            let speed = deltaTime*this._speed*250;\r\n            pos.x += speed;\r\n            if (pos.x <= 8) { pos.x = 8; }\r\n            if(pos.x>=Constant.CurMapWidth - 8){pos.x = Constant.CurMapWidth - 8;}\r\n            this.node.setPosition(pos);\r\n            let scale = this.node.getScale();\r\n            let gap = this._speed > 0 ? 1 : -1;\r\n            scale.x = gap*Math.abs(scale.x);\r\n            // this.node.setScale(scale);\r\n            this.setOwnScale(scale);\r\n            clientEvent.dispatchEvent(Constant.EVENT_TYPE.MoveCamera, [pos, speed]);\r\n        }\r\n        \r\n        let pos = this.node.getPosition();\r\n        if (pos.y < -40) {\r\n            this._evtPlayMarioDeath(true);\r\n            return;\r\n        }\r\n        \r\n        switch(this._status){\r\n            case MarioStatus.jump:\r\n                // console.log(pos.y,this._jumpPoint.y)\r\n                // console.log(Math.abs(pos.y - this._jumpPoint.y))\r\n                if(Math.abs(pos.y - this._jumpPoint.y)<3){\r\n                    if(this._isMoving){\r\n                        this.playWalk();\r\n                    }\r\n                    else{\r\n                        this.playIdle();\r\n                    }\r\n                }\r\n                break;\r\n\r\n            case MarioStatus.finish:\r\n                this._speed = this._speedHalf;\r\n                break;\r\n\r\n            case MarioStatus.idle:\r\n                this.playIdle();\r\n                break;\r\n\r\n            case MarioStatus.walk:\r\n                \r\n                break;\r\n            default:break;\r\n        }\r\n    }\r\n\r\n    async playIdle() {\r\n        if (!this._anim) {\r\n            await this._loadAnimComponent();\r\n        }\r\n        if(!this._isCandoAction(MarioStatus.idle))return;\r\n        this._anim.play(AnimMario.idle);\r\n    }\r\n    async playWalk() {\r\n        if (!this._anim) {\r\n            await this._loadAnimComponent();\r\n        }\r\n        if(!this._isCandoAction(MarioStatus.walk))return;\r\n        this._anim.play(AnimMario.walk);\r\n    }\r\n    async _evtPlayMarioDeath(isDown: boolean = false) {\r\n        if (this._isDeath) return;\r\n        if (!this._anim) {\r\n            await this._loadAnimComponent();\r\n        }\r\n        this.node.getComponent(PolygonCollider2D).destroy();\r\n        this._status = MarioStatus.death;\r\n        this._anim.play(AnimMario.death);\r\n        this._isDeath = true;\r\n        let pos = this.node.getPosition();\r\n        this.node.setPosition(v3(pos.x, pos.y + 2, pos.z));\r\n        if (isDown) {\r\n            this._rigidbody2d.applyForce(v2(0, 2800), v2(0, 0), true);\r\n        }\r\n        else {\r\n            this._rigidbody2d.applyForce(v2(0, 1300), v2(0, 0), true);\r\n        }\r\n        //刷新复活点\r\n        roleManager.Inst.updateAlivePoint(pos)\r\n        //先让他复活\r\n        this.scheduleOnce(() => {\r\n            this.node.destroy();\r\n            clientEvent.dispatchEvent(Constant.EVENT_TYPE.TranslateScenes);\r\n        }, 2);\r\n    }\r\n    async playSwim() {\r\n        if (!this._anim) {\r\n            await this._loadAnimComponent();\r\n        }\r\n        if(!this._isCandoAction(MarioStatus.swim))return;\r\n        this._anim.play(AnimMario.swim);\r\n    }\r\n\r\n    async playJump() {\r\n        if (!this._anim) {\r\n            await this._loadAnimComponent();\r\n        }\r\n        let pos = this.node.getPosition();\r\n        this._jumpPoint = v3(pos.x,pos.y,pos.z);\r\n        pos.y+=5;\r\n        this.node.setPosition(pos);\r\n        if(!this._isCandoAction(MarioStatus.jump))return;\r\n        this._anim.play(AnimMario.jump);\r\n        this._rigidbody2d.applyForce(v2(0, 950), v2(0, 0), true);\r\n    }\r\n\r\n    /**\r\n     * 判断当前动作是否可以执行\r\n     * @param status \r\n     * @returns \r\n     */\r\n    private _isCandoAction(status:MarioStatus):Boolean{\r\n        if(this._isDeath) return false;\r\n        if(this._status == MarioStatus.death) return false;\r\n        if(this._status == status) return false;\r\n        this._status = status;\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * 左右移动\r\n     * @param pos \r\n     */\r\n    private _evtStartMove(pos: Vec3) {\r\n        if (!this._isMoving || this._status != MarioStatus.walk) {\r\n            if(this._status != MarioStatus.jump){\r\n                this.playWalk();\r\n            }\r\n        }\r\n        this._isMoving = true;\r\n        this._speed = pos.x < 0 ? -1 :1;\r\n    }\r\n    private _evtStop() {\r\n        this._isMoving = false;\r\n        this.playIdle();\r\n    }\r\n\r\n    /**\r\n     * 跳，给一个向上的force\r\n     */\r\n    private async _evtJump() {\r\n        if (!this._rigidbody2d) {\r\n            await this._loadRigidBody2d();\r\n        }\r\n        if (this._status == MarioStatus.jump) {\r\n            return;\r\n        }\r\n        this.playJump();\r\n    }\r\n\r\n    /**\r\n     * 与砖头上面接触\r\n     */\r\n    handleColliderUp() {\r\n        if (this._isMoving) {\r\n            this.playWalk();\r\n        }\r\n        else {\r\n            this.playIdle();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 碰撞检测\r\n     * @param selfCollider  \r\n     * @param otherCollider \r\n     * @param contact \r\n     */\r\n    public onBeginContact(selfCollider: Collider2D, otherCollider: Collider2D, contact: IPhysics2DContact | null) {\r\n        // 只在两个碰撞体开始接触时被调用一次\r\n        let name1 = selfCollider.node.name;\r\n        let name2 = otherCollider.node.name;\r\n        if(name2 == this._lastColliderName || !Constant.CurMap.physicsStatus)return;\r\n        this._lastColliderName = name2;\r\n        if(this._status == MarioStatus.jump){\r\n            this.handleColliderUp();//起跳过程中发生碰撞，直接改变状态\r\n        }\r\n        if(name2.includes(\"tower\")){\r\n            roleManager.Inst.nextLevel();\r\n        }\r\n        if(Constant.FinishedGame)return;\r\n        if(name2.includes(\"flag\")){\r\n            this._check_gameOver();\r\n        }\r\n\r\n        if (name1.includes(\"mario\") && name2.includes(\"wall\")) {\r\n            let bk: brick = otherCollider.node.getComponent(brick);\r\n            let points = contact.getWorldManifold().points;\r\n            if (bk) {\r\n                if (points.length > 0) {\r\n                    let cPos = points[0];\r\n                    let bPos = otherCollider.node.getWorldPosition();\r\n                    if (cPos.y <= bPos.y - 8) {\r\n                        clientEvent.dispatchEvent(Constant.EVENT_TYPE.BrickMove + bk.index, bk.index);\r\n                    }\r\n                    else if (cPos.y >= bPos.y + 8) {\r\n                        // let mar = selfCollider.node.getComponent(mario);\r\n                        // mar.handleColliderUp();\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        else if (name1.includes(\"mario\") && name2.includes(\"coin_brick\")) {\r\n            let bk: whyBrick = otherCollider.node.getComponent(whyBrick);\r\n            let points = contact.getWorldManifold().points;\r\n            if (bk) {\r\n                if (points.length > 0) {\r\n                    let cPos = points[0];\r\n                    let bPos = otherCollider.node.getWorldPosition();\r\n                    if (cPos.y <= bPos.y - 8) {\r\n                        clientEvent.dispatchEvent(Constant.EVENT_TYPE.TopWhy + bk.index, bk.index);\r\n                    }\r\n                    else if (cPos.y >= bPos.y + 8) {\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        else if (name1.includes(\"mario\") && name2.includes(\"hole\")) {\r\n            let ut = otherCollider.node.getComponent(UITransform);\r\n            let points = contact.getWorldManifold().points;\r\n            if (ut) {\r\n                if (points.length > 0) {\r\n                    let cPos = points[0];\r\n                    let bPos = otherCollider.node.getWorldPosition();\r\n                    if (cPos.y >= bPos.y + ut.height / 2) {\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        else if (name1.includes(\"mario\") && name2.includes(\"ladder\")) {\r\n        }\r\n        if(name2.includes(\"mushroom\")){\r\n            this.handleMushroom();\r\n        }\r\n    }\r\n\r\n    private handleMushroom(){\r\n        clientEvent.dispatchEvent(Constant.EVENT_TYPE.EnablePhysics,false);\r\n        let scale = this.node.getScale();\r\n        if(Constant.BodyStatus == MarioBodyStatus.normal){//变大\r\n            clientEvent.dispatchEvent(Constant.EVENT_TYPE.MushRoomDestroy)\r\n            let scalex1 = scale.x>0 ? 3 : -3;\r\n            let scalex2 = scale.x>0 ? 2.8 : -2.8;\r\n            let scalex3 = scale.x>0 ? 4 : -4;\r\n            let scalex4 = scale.x>0 ? 3.8 : -3.8;\r\n            let scalex5 = scale.x>0 ? 5 : -5;\r\n            let scaley1 = scale.y>0 ? 3 : -3;\r\n            let scaley2 = scale.y>0 ? 2.8 : -2.8;\r\n            let scaley3 = scale.y>0 ? 4 : -4;\r\n            let scaley4 = scale.y>0 ? 3.8 : -3.8;\r\n            let scaley5 = scale.y>0 ? 5 : -5;\r\n            tween(this.node).to(0.2,{scale:v3(scalex1,scaley1,scale.z)})\r\n            .to(0.1,{scale:v3(scalex2,scaley2,scale.z)})\r\n            .to(0.2,{scale:v3(scalex3,scaley3,scale.z)})\r\n            .to(0.1,{scale:v3(scalex4,scaley4,scale.z)})\r\n            .to(0.2,{scale:v3(scalex5,scaley5,scale.z)})\r\n            .call(()=>{\r\n                console.log(\"--121231\")\r\n                clientEvent.dispatchEvent(Constant.EVENT_TYPE.EnablePhysics,true);\r\n                Constant.BodyStatus = MarioBodyStatus.huge;\r\n            })\r\n            .start();\r\n        }\r\n    }\r\n\r\n    private _check_gameOver(){\r\n        Constant.FinishedGame = true;\r\n        this.playWalk();\r\n        this._status = MarioStatus.finish;\r\n        clientEvent.dispatchEvent(Constant.EVENT_TYPE.FinishedGame);\r\n        // this.playIdle();\r\n        // this.scheduleOnce(()=>{\r\n        //     this.playWalk();\r\n        //     let pos = this.node.getPosition();\r\n        //     let nPos = v3(pos.x+270,20.7,pos.z);\r\n        //     tween(this.node).to(2,{position:nPos}).call(()=>{}).start();\r\n        // },1);\r\n    }\r\n\r\n    private _evtChangeStatus(status:MarioStatus){\r\n        this._status = status;\r\n    }\r\n\r\n    private setOwnScale(scale:Vec3){\r\n        this.node.setScale(scale);\r\n    }\r\n}\r\n\r\n"]}