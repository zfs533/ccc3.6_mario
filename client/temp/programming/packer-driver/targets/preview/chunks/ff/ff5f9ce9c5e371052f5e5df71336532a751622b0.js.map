{"version":3,"sources":["file:///E:/CocosCreator/git/mario/client/assets/script/game/pieces/whyBrick.ts"],"names":["_decorator","Component","Sprite","instantiate","Enum","clientEvent","Constant","ResourcePath","whyType","PoolManager","resourceUtil","getBrickIndex","coin","ccclass","property","whyBrick","type","index","_isGot","start","_init","_addListener","on","EVENT_TYPE","TopWhy","_evtTopWhy","onDestroy","off","idx","normal","_playMoveUp","mushroom","_loadMushroom","_setFinishedStatus","pre","loadPiecesPriefabRes","node","pos","getWorldPosition","setWorldPosition","dispatchEvent","AddToMap","Inst","getNode","getComponent","CoinRemove","setSpriteFrame","textureBrick"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, Vec3, tween, v3, SpriteFrame, SpriteComponent, Sprite, instantiate, Enum, UITransform, UITransformComponent, Prefab } from 'cc';\r\nimport { clientEvent } from '../../framework/clientEvent';\r\nimport { Constant } from '../../framework/constant';\r\nimport { ResourcePath, whyType } from '../../framework/enum';\r\nimport { PoolManager } from '../../framework/poolManager';\r\nimport { resourceUtil } from '../../framework/resourceUtil';\r\nimport { getBrickIndex } from '../../net/util';\r\nimport { coin } from './coin';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('whyBrick')\r\nexport class whyBrick extends Component {\r\n    @property({ type: Enum(whyType) })\r\n    type: whyType = whyType.normal;\r\n\r\n    public index: number = 0;\r\n    private _isGot: boolean = false;//是否已经顶过了\r\n    start() {\r\n        this._init();\r\n        this._addListener();\r\n    }\r\n\r\n    private _addListener() {\r\n        clientEvent.on(Constant.EVENT_TYPE.TopWhy + this.index, this._evtTopWhy, this);\r\n    }\r\n\r\n    onDestroy() {\r\n        clientEvent.off(Constant.EVENT_TYPE.TopWhy + this.index, this._evtTopWhy, this);\r\n    }\r\n\r\n    private _evtTopWhy(idx) {\r\n        if (idx == this.index && !this._isGot) {\r\n            switch (this.type) {\r\n                case whyType.normal:\r\n                    this._playMoveUp();\r\n                    break;\r\n\r\n                case whyType.mushroom:\r\n                    this._loadMushroom();\r\n                    break;\r\n            }\r\n        }\r\n    }\r\n\r\n    private async _loadMushroom() {\r\n        this._isGot = true;\r\n        this._setFinishedStatus();\r\n        let pre = await resourceUtil.loadPiecesPriefabRes(\"mushroom\")\r\n        if (pre) {\r\n            //蘑菇mushroom\r\n            let node = instantiate(pre) as Node;\r\n            let pos = this.node.getWorldPosition();\r\n            node.setWorldPosition(pos);\r\n            clientEvent.dispatchEvent(Constant.EVENT_TYPE.AddToMap, node);\r\n        }\r\n    }\r\n    private async _playMoveUp() {\r\n        this._isGot = true;\r\n        this._setFinishedStatus();\r\n        let pre:Prefab = await resourceUtil.loadPiecesPriefabRes(\"coin\")\r\n        if (pre) {\r\n            //加载金币并发送消除金币事件\r\n            let node = await PoolManager.Inst.getNode(pre,this.node);\r\n            // let node = instantiate(pre) as Node;\r\n            // this.node.addChild(node);\r\n            let idx = node.getComponent(coin).index;\r\n            clientEvent.dispatchEvent(Constant.EVENT_TYPE.CoinRemove + idx);\r\n        }\r\n    }\r\n\r\n    private _setFinishedStatus() {\r\n        resourceUtil.setSpriteFrame(ResourcePath.textureBrick + \"whyDown\", this.node.getComponent(Sprite), () => { });\r\n    }\r\n\r\n    private _init() {\r\n        this.index = getBrickIndex();\r\n    }\r\n}\r\n\r\n"]}