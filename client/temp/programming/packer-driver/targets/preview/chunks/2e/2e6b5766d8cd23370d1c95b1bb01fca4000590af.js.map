{"version":3,"sources":["file:///E:/CocosCreator/git/mario/client/assets/script/game/roles/enemy/enemy.ts"],"names":["_decorator","Animation","Node","cfgEnemy","EnumEnemyStatus","EnumPhysicsGroup","baseCollider","ccclass","property","enemy","speed","normalX","isDeath","_data","status","stand","isColider","start","setPhysicsGroup","getEnemyData","node","name","animComp","play","walk","getComponent","onDestroy","onBeginContact","selfCollider","otherCollider","contact","name1","name2","includes","normal","getWorldManifold","startMoving","x","offset","scale","getScale","scalex","setScale","y","z","refreshSpeedByStatus","death","run","update","deltaTime","pos","getPosition","setPosition","playDeath","scheduleOnce","destroy","getData","undefined"],"mappings":"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","sourcesContent":["import { _decorator, Animation, Node, Collider2D, IPhysics2DContact, RigidBody2D, BoxCollider2D } from 'cc';\r\nimport { cfgEnemy, EnemyData } from '../../../config/cfgEnemy';\r\nimport { EnumEnemyStatus, EnumPhysicsGroup } from '../../../framework/enum';\r\nimport { baseCollider } from '../../collider/baseCollider';\r\nconst { ccclass, property } = _decorator;\r\n/**\r\n * 怪物基类\r\n */\r\n@ccclass('enemy')\r\nexport class enemy extends baseCollider {\r\n    @property(Node)\r\n    attactedNode:Node = undefined;\r\n\r\n    @property(Animation)\r\n    animComp:Animation = undefined;\r\n\r\n    public speed: number = 1;\r\n    public normalX: number = 0;\r\n    public isDeath: boolean = false;\r\n    private _data:EnemyData = null;\r\n    protected status:EnumEnemyStatus = EnumEnemyStatus.stand;\r\n    protected isColider:boolean = false;//碰上了,用来处理连续碰撞造成的问题\r\n    \r\n    start() {\r\n        super.start();\r\n        this.setPhysicsGroup(EnumPhysicsGroup.enemy)\r\n        this._data = cfgEnemy.getEnemyData(this.node.name);\r\n        if(this.animComp){\r\n            this.animComp.play(this._data.walk);\r\n        } else {\r\n            this.node.getComponent(Animation).play(this._data.walk);\r\n        }\r\n    }\r\n\r\n    onDestroy() {\r\n    }\r\n\r\n    public onBeginContact(selfCollider: Collider2D, otherCollider: Collider2D, contact: IPhysics2DContact | null) {\r\n        if (this.isDeath) return;\r\n        // 只在两个碰撞体开始接触时被调用一次\r\n        let name1 = selfCollider.node.name;\r\n        let name2 = otherCollider.node.name;\r\n        if (name1.includes(\"enemy\")) {\r\n            let normal = contact.getWorldManifold().normal;\r\n            this.startMoving(normal.x);\r\n        }\r\n    }\r\n\r\n    public startMoving(offset: number) {\r\n        if (offset != this.normalX) {\r\n            this.speed *= -1;\r\n            this.normalX = offset;\r\n            let scale = this.node.getScale();\r\n            let scalex = scale.x *-1;\r\n            this.node.setScale(scalex,scale.y,scale.z);\r\n        }\r\n    }\r\n\r\n    refreshSpeedByStatus(){\r\n        switch(this.status){\r\n            case EnumEnemyStatus.stand:\r\n            case EnumEnemyStatus.death:\r\n                this.speed = 0;\r\n                break;\r\n\r\n            case EnumEnemyStatus.walk:\r\n                this.speed = 1;\r\n                break;\r\n\r\n            case EnumEnemyStatus.run:\r\n                this.speed = 5;\r\n                break;\r\n            \r\n        }\r\n    }\r\n\r\n    update(deltaTime: number) {\r\n        if (this.isDeath) return;\r\n        let pos = this.node.getPosition();\r\n        pos.x += this.speed;\r\n        this.node.setPosition(pos);\r\n    }\r\n\r\n    public playDeath() {\r\n        if(this.isDeath)return;\r\n        this.isDeath = true;\r\n        this.node.getComponent(Animation).play(this._data.death);\r\n        this.scheduleOnce(() => {\r\n            this.node.destroy();\r\n        }, 0.4);\r\n    }\r\n\r\n    protected getData():EnemyData{\r\n        return this._data;\r\n    }\r\n}\r\n\r\n"]}