{"version":3,"sources":["file:///E:/CocosCreator/git/mario/client/assets/script/game/roles/mario/mario.ts"],"names":["Animation","PolygonCollider2D","RigidBody2D","tween","UITransformComponent","v2","v3","Vec3","_decorator","clientEvent","Constant","AnimMario","MarioStatus","baseCollider","brick","whyBrick","roleManager","ccclass","property","mario","_anim","undefined","_rigidbody2d","_speed","_isMoving","_isLeft","_isJumping","_jumpPoint","_status","_isDeath","_lastColliderName","start","_init","_addListener","on","EVENT_TYPE","Move","_evtStartMove","Stop","_evtStop","Jump","_evtJump","MarioDeath","_evtPlayMarioDeath","onDestroy","off","MoveSpeed","_loadAnimComponent","_loadRigidBody2d","playIdle","Promise","resolve","node","getComponent","update","deltaTime","pos","getPosition","scale","getScale","offset","x","Math","abs","CurMapWidth","setPosition","setScale","dispatchEvent","MoveCamera","y","playWalk","idle","play","walk","isDown","destroy","death","z","applyForce","Inst","updateAlivePoint","scheduleOnce","TranslateScenes","playSwim","swim","playJump","jump","handleColliderUp","onBeginContact","selfCollider","otherCollider","contact","name1","name","name2","console","log","includes","FinishedGame","nPos","to","position","bk","points","getWorldManifold","length","cPos","bPos","getWorldPosition","BrickMove","index","mar","TopWhy","ut","height"],"mappings":"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","sourcesContent":["import { Animation, BoxCollider2D, Collider2D, Component, IPhysics2DContact, PolygonCollider2D, RigidBody2D, tween, UITransformComponent, v2, v3, Vec3, _decorator } from 'cc';\r\nimport { clientEvent } from '../../../framework/clientEvent';\r\nimport { Constant } from '../../../framework/constant';\r\nimport { AnimMario, MarioStatus } from '../../../framework/enum';\r\nimport { baseCollider } from '../../collider/baseCollider';\r\nimport { brick } from '../../pieces/brick';\r\nimport { whyBrick } from '../../pieces/whyBrick';\r\nimport { roleManager } from '../roleManager';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('mario')\r\nexport class mario extends baseCollider {\r\n    private _anim: Animation = undefined;\r\n    private _rigidbody2d: RigidBody2D = undefined;\r\n    private _speed: number = -1;\r\n    private _isMoving: boolean = false;\r\n    private _isLeft: boolean = false;\r\n    private _isJumping: boolean = false;\r\n    private _jumpPoint: Vec3 = new Vec3();\r\n    private _status: number = 0;\r\n    private _isDeath: boolean = false;\r\n    private _lastColliderName:string = \"\";\r\n    start() {\r\n        super.start();\r\n        this._init();\r\n        this._addListener();\r\n    }\r\n\r\n    private _addListener() {\r\n        clientEvent.on(Constant.EVENT_TYPE.Move, this._evtStartMove, this);\r\n        clientEvent.on(Constant.EVENT_TYPE.Stop, this._evtStop, this);\r\n        clientEvent.on(Constant.EVENT_TYPE.Jump, this._evtJump, this);\r\n        clientEvent.on(Constant.EVENT_TYPE.MarioDeath, this._evtPlayMarioDeath, this);\r\n    }\r\n\r\n    onDestroy() {\r\n        clientEvent.off(Constant.EVENT_TYPE.Move, this._evtStartMove, this);\r\n        clientEvent.off(Constant.EVENT_TYPE.Stop, this._evtStop, this);\r\n        clientEvent.off(Constant.EVENT_TYPE.Jump, this._evtJump, this);\r\n        clientEvent.off(Constant.EVENT_TYPE.MarioDeath, this._evtPlayMarioDeath, this);\r\n    }\r\n\r\n    private _init() {\r\n        this._speed = Constant.MoveSpeed / 2;\r\n        this._loadAnimComponent();\r\n        this._loadRigidBody2d();\r\n        this.playIdle();\r\n    }\r\n    private _loadAnimComponent() {\r\n        return new Promise(resolve => {\r\n            this._anim = this.node.getComponent(Animation);\r\n            resolve(null);\r\n        });\r\n    }\r\n    private _loadRigidBody2d() {\r\n        return new Promise(resolve => {\r\n            this._rigidbody2d = this.node.getComponent(RigidBody2D);\r\n            resolve(null);\r\n        });\r\n    }\r\n\r\n    update(deltaTime: number) {\r\n        if (this._isDeath) return;\r\n        //移动状态\r\n        let pos = this.node.getPosition();\r\n        if (this._isMoving) {\r\n            let scale = this.node.getScale();\r\n            let offset = 0;\r\n            if (this._isLeft) {\r\n                pos.x -= this._speed;\r\n                offset = -this._speed;\r\n                scale.x = -Math.abs(scale.x);\r\n            }\r\n            else {\r\n                offset = +this._speed;\r\n                pos.x += this._speed;\r\n                scale.x = Math.abs(scale.x);\r\n            }\r\n            if (pos.x <= 8) { pos.x = 8; }\r\n            if(pos.x>=Constant.CurMapWidth - 8){pos.x = Constant.CurMapWidth - 8;}\r\n            this.node.setPosition(pos);\r\n            this.node.setScale(scale);\r\n            clientEvent.dispatchEvent(Constant.EVENT_TYPE.MoveCamera, [pos, offset]);\r\n        }\r\n        if (pos.y < -40) {\r\n            this._evtPlayMarioDeath(true);\r\n            return;\r\n        }\r\n        //起跳状态\r\n        if (this._isJumping) {\r\n            let pos = this.node.getPosition();\r\n            if (pos.y <= this._jumpPoint.y + 1) {\r\n                this._isJumping = false;\r\n\r\n                if (!this._isMoving) {\r\n                    this.playIdle();\r\n                }\r\n                else {\r\n                    this.playWalk();\r\n                }\r\n            }\r\n        }\r\n\r\n    }\r\n    async playIdle() {\r\n        if (this._isDeath) return;\r\n        if (!this._anim) {\r\n            await this._loadAnimComponent();\r\n        }\r\n        this._status = MarioStatus.idle;\r\n        this._isJumping = false;\r\n        this._anim.play(AnimMario.idle);\r\n    }\r\n    async playWalk() {\r\n        if (this._isDeath) return;\r\n        if (this._status == MarioStatus.walk) return;\r\n        if (!this._anim) {\r\n            await this._loadAnimComponent();\r\n        }\r\n        this._status = MarioStatus.walk;\r\n        this._anim.play(AnimMario.walk);\r\n    }\r\n    async _evtPlayMarioDeath(isDown: boolean = false) {\r\n        if (this._isDeath) return;\r\n        if (!this._anim) {\r\n            await this._loadAnimComponent();\r\n        }\r\n        this.node.getComponent(PolygonCollider2D).destroy();\r\n        this._status = MarioStatus.death;\r\n        this._anim.play(AnimMario.death);\r\n        this._isDeath = true;\r\n        let pos = this.node.getPosition();\r\n        this.node.setPosition(v3(pos.x, pos.y + 2, pos.z));\r\n        if (isDown) {\r\n            this._rigidbody2d.applyForce(v2(0, 2800), v2(0, 0), true);\r\n        }\r\n        else {\r\n            this._rigidbody2d.applyForce(v2(0, 1300), v2(0, 0), true);\r\n        }\r\n        //刷新复活点\r\n        roleManager.Inst.updateAlivePoint(pos)\r\n        //先让他复活\r\n        this.scheduleOnce(() => {\r\n            this.node.destroy();\r\n            // roleManager.Inst.addMarioToMap();\r\n            clientEvent.dispatchEvent(Constant.EVENT_TYPE.TranslateScenes);\r\n        }, 2);\r\n    }\r\n    async playSwim() {\r\n        if (this._isDeath) return;\r\n        if (!this._anim) {\r\n            await this._loadAnimComponent();\r\n        }\r\n        this._status = MarioStatus.swim;\r\n        this._anim.play(AnimMario.swim);\r\n    }\r\n\r\n    async playJump() {\r\n        if (this._isDeath) return;\r\n        if (!this._anim) {\r\n            await this._loadAnimComponent();\r\n        }\r\n        let pos = this.node.getPosition();\r\n        this._jumpPoint = pos;\r\n        this._status = MarioStatus.jump;\r\n        this._anim.play(AnimMario.jump);\r\n    }\r\n\r\n    /**\r\n     * 左右移动\r\n     * @param pos \r\n     */\r\n    private _evtStartMove(pos: Vec3) {\r\n        if (!this._isMoving || this._status != MarioStatus.walk) {\r\n            this.playWalk();\r\n        }\r\n        this._isMoving = true;\r\n        this._isLeft = false;\r\n        if (pos.x < 0) {\r\n            this._isLeft = true;\r\n        }\r\n    }\r\n    private _evtStop() {\r\n        this._isMoving = false;\r\n        this.playIdle();\r\n    }\r\n\r\n    /**\r\n     * 跳，给一个向上的force\r\n     */\r\n    private async _evtJump() {\r\n        if (!this._rigidbody2d) {\r\n            await this._loadRigidBody2d();\r\n        }\r\n        if (this._isJumping) {\r\n            return;\r\n        }\r\n        this._isJumping = true;\r\n        this.playJump();\r\n        let pos = this.node.getPosition();\r\n        this.node.setPosition(v3(pos.x, pos.y + 2, pos.z));\r\n        this._rigidbody2d.applyForce(v2(0, 950), v2(0, 0), true);\r\n    }\r\n\r\n    /**\r\n     * 与砖头上面接触\r\n     */\r\n    handleColliderUp() {\r\n        this._isJumping = false;\r\n        if (this._isMoving) {\r\n            this.playWalk();\r\n        }\r\n        else {\r\n            this.playIdle();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 碰撞检测\r\n     * @param selfCollider  \r\n     * @param otherCollider \r\n     * @param contact \r\n     */\r\n    public onBeginContact(selfCollider: Collider2D, otherCollider: Collider2D, contact: IPhysics2DContact | null) {\r\n        // 只在两个碰撞体开始接触时被调用一次\r\n        let name1 = selfCollider.node.name;\r\n        let name2 = otherCollider.node.name;\r\n        if(name2 == this._lastColliderName)return;\r\n        this._lastColliderName = name2;\r\n        console.log(name2);\r\n        if(name2.includes(\"flag\")){\r\n            console.log(\" i am flag\")\r\n        }\r\n        if(name2.includes(\"flag1\")){\r\n            console.log(\" i am flag1\")\r\n        }\r\n        if(name2.includes(\"flag\")){\r\n            console.log(\"finished_game\");\r\n            Constant.FinishedGame = true;\r\n            clientEvent.dispatchEvent(Constant.EVENT_TYPE.FinishedGame);\r\n            let pos = this.node.getPosition();\r\n            let nPos = v3(pos.x+300,pos.y,pos.z);\r\n            tween(this.node).to(2,{position:nPos});\r\n        }\r\n\r\n        if(Constant.FinishedGame)return;\r\n        if (name1.includes(\"mario\") && name2.includes(\"wall\")) {\r\n            let bk: brick = otherCollider.node.getComponent(brick);\r\n            let points = contact.getWorldManifold().points;\r\n            if (bk) {\r\n                if (points.length > 0) {\r\n                    let cPos = points[0];\r\n                    let bPos = otherCollider.node.getWorldPosition();\r\n                    if (cPos.y <= bPos.y - 8) {\r\n                        clientEvent.dispatchEvent(Constant.EVENT_TYPE.BrickMove + bk.index, bk.index);\r\n                    }\r\n                    else if (cPos.y >= bPos.y + 8) {\r\n                        let mar = selfCollider.node.getComponent(mario);\r\n                        mar.handleColliderUp();\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        else if (name1.includes(\"mario\") && name2.includes(\"coin\")) {\r\n            let bk: whyBrick = otherCollider.node.getComponent(whyBrick);\r\n            let points = contact.getWorldManifold().points;\r\n            if (bk) {\r\n                if (points.length > 0) {\r\n                    let cPos = points[0];\r\n                    let bPos = otherCollider.node.getWorldPosition();\r\n                    if (cPos.y <= bPos.y - 8) {\r\n                        clientEvent.dispatchEvent(Constant.EVENT_TYPE.TopWhy + bk.index, bk.index);\r\n                    }\r\n                    else if (cPos.y >= bPos.y + 8) {\r\n                        let mar = selfCollider.node.getComponent(mario);\r\n                        mar.handleColliderUp();\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        else if (name1.includes(\"mario\") && name2.includes(\"hole\")) {\r\n            let ut = otherCollider.node.getComponent(UITransformComponent);\r\n            let points = contact.getWorldManifold().points;\r\n            if (ut) {\r\n                if (points.length > 0) {\r\n                    let cPos = points[0];\r\n                    let bPos = otherCollider.node.getWorldPosition();\r\n                    if (cPos.y >= bPos.y + ut.height / 2) {\r\n                        let mar = selfCollider.node.getComponent(mario);\r\n                        mar.handleColliderUp();\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        else if (name1.includes(\"mario\") && name2.includes(\"ladder\")) {\r\n            let mar = selfCollider.node.getComponent(mario);\r\n            mar.handleColliderUp();\r\n        }\r\n        // if(name2.includes(\"flag\")){\r\n        //     console.log(\"finished_game\");\r\n        //     Constant.FinishedGame = true;\r\n        //     clientEvent.dispatchEvent(Constant.EVENT_TYPE.FinishedGame);\r\n        //     let pos = this.node.getPosition();\r\n        //     let nPos = v3(pos.x+300,pos.y,pos.z);\r\n        //     tween(this.node).to(2,{position:nPos});\r\n        // }\r\n    }\r\n}\r\n\r\n"]}