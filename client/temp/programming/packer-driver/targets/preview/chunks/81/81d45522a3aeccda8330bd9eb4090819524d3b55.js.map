{"version":3,"sources":["file:///E:/CocosCreator/git/mario/client/assets/script/game/pieces/coin.ts"],"names":["_decorator","Component","BoxCollider2D","RigidBody2D","AudioManager","clientEvent","Constant","PoolManager","getBrickIndex","ccclass","property","coin","index","_isDistoried","onEnable","_init","_addListener","on","EVENT_TYPE","CoinRemove","_evtCoinRemove","onDestroy","off","console","log","isImideltly","instance","playSound","child","node","children","boxCollider","getComponent","enabled","destroy","rigidbody","Inst","setNode","scheduleOnce"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;AAAiBC,MAAAA,a,OAAAA,a;AAAeC,MAAAA,W,OAAAA,W;;AAC5CC,MAAAA,Y,iBAAAA,Y;;AACAC,MAAAA,W,iBAAAA,W;;AACAC,MAAAA,Q,iBAAAA,Q;;AACAC,MAAAA,W,iBAAAA,W;;AACAC,MAAAA,a,iBAAAA,a;;;;;;;;;OACH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBV,U;;sBAGjBW,I,WADZF,OAAO,CAAC,MAAD,C,gBAAR,MACaE,IADb,SAC0BV,SAD1B,CACoC;AAAA;AAAA;AAAA,eACzBW,KADyB,GACT,CADS;AAAA,eAExBC,YAFwB,GAED,KAFC;AAAA;;AAGhCC,QAAAA,QAAQ,GAAG;AACP,eAAKC,KAAL;;AACA,eAAKC,YAAL;AACH;;AAEOA,QAAAA,YAAY,GAAG;AACnB;AAAA;AAAA,0CAAYC,EAAZ,CAAe;AAAA;AAAA,oCAASC,UAAT,CAAoBC,UAApB,GAAiC,KAAKP,KAArD,EAA4D,KAAKQ,cAAjE,EAAiF,IAAjF;AACH;;AAEDC,QAAAA,SAAS,GAAG;AACR;AAAA;AAAA,0CAAYC,GAAZ,CAAgB;AAAA;AAAA,oCAASJ,UAAT,CAAoBC,UAApB,GAAiC,KAAKP,KAAtD,EAA6D,KAAKQ,cAAlE,EAAkF,IAAlF;AACH;;AACOL,QAAAA,KAAK,GAAG;AACZ,eAAKH,KAAL,GAAa;AAAA;AAAA,+CAAb;AACAW,UAAAA,OAAO,CAACC,GAAR,CAAY,KAAKZ,KAAjB;AACH;;AAEOQ,QAAAA,cAAc,CAACK,WAAD,EAA+B;AAAA,cAA9BA,WAA8B;AAA9BA,YAAAA,WAA8B,GAAP,KAAO;AAAA;;AACjD,cAAG,KAAKZ,YAAR,EAAsB;AACtB,eAAKA,YAAL,GAAoB,IAApB;AACAU,UAAAA,OAAO,CAACC,GAAR,CAAY,wBAAsB,KAAKX,YAA3B,GAA0C,SAA1C,GAAoD,KAAKD,KAArE;AACA;AAAA;AAAA,4CAAac,QAAb,CAAsBC,SAAtB,CAAgC,UAAhC,EAA2C,KAA3C;AAEA,cAAIC,KAAU,GAAG,KAAKC,IAAL,CAAUC,QAAV,CAAmB,CAAnB,CAAjB;AACA,cAAIC,WAAW,GAAGH,KAAK,CAACI,YAAN,CAAmB9B,aAAnB,CAAlB;AACA6B,UAAAA,WAAW,CAACE,OAAZ,GAAsB,KAAtB;AACAF,UAAAA,WAAW,CAACG,OAAZ;AACA,cAAIC,SAAS,GAAGP,KAAK,CAACI,YAAN,CAAmB7B,WAAnB,CAAhB;AACAgC,UAAAA,SAAS,CAACF,OAAV,GAAoB,KAApB;AACAE,UAAAA,SAAS,CAACD,OAAV;;AACA,cAAIT,WAAJ,EAAiB;AACb;AAAA;AAAA,4CAAYW,IAAZ,CAAiBC,OAAjB,CAAyB,KAAKR,IAA9B;AACH,WAFD,MAGK;AACD,iBAAKS,YAAL,CAAkB,MAAM;AACpB;AAAA;AAAA,8CAAYF,IAAZ,CAAiBC,OAAjB,CAAyB,KAAKR,IAA9B;AACH,aAFD,EAEG,GAFH;AAGH;AACJ;;AAzC+B,O","sourcesContent":["import { _decorator, Component, Node, BoxCollider2D, RigidBody2D } from 'cc';\r\nimport { AudioManager } from '../../framework/audioManager';\r\nimport { clientEvent } from '../../framework/clientEvent';\r\nimport { Constant } from '../../framework/constant';\r\nimport { PoolManager } from '../../framework/poolManager';\r\nimport { getBrickIndex } from '../../net/util';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('coin')\r\nexport class coin extends Component {\r\n    public index: number = 0;\r\n    private _isDistoried:boolean = false;\r\n    onEnable() {\r\n        this._init();\r\n        this._addListener();\r\n    }\r\n\r\n    private _addListener() {\r\n        clientEvent.on(Constant.EVENT_TYPE.CoinRemove + this.index, this._evtCoinRemove, this);\r\n    }\r\n\r\n    onDestroy() {\r\n        clientEvent.off(Constant.EVENT_TYPE.CoinRemove + this.index, this._evtCoinRemove, this);\r\n    }\r\n    private _init() {\r\n        this.index = getBrickIndex();\r\n        console.log(this.index);\r\n    }\r\n\r\n    private _evtCoinRemove(isImideltly: boolean = false) {\r\n        if(this._isDistoried) return;\r\n        this._isDistoried = true;\r\n        console.log(\"this._isDistoried: \"+this._isDistoried+  \"index: \"+this.index);\r\n        AudioManager.instance.playSound(\"smb_coin\",false);\r\n        \r\n        let child:Node = this.node.children[0];\r\n        let boxCollider = child.getComponent(BoxCollider2D);\r\n        boxCollider.enabled = false;\r\n        boxCollider.destroy();\r\n        let rigidbody = child.getComponent(RigidBody2D);\r\n        rigidbody.enabled = false;\r\n        rigidbody.destroy();\r\n        if (isImideltly) {\r\n            PoolManager.Inst.setNode(this.node);\r\n        }\r\n        else {\r\n            this.scheduleOnce(() => {\r\n                PoolManager.Inst.setNode(this.node);\r\n            }, 0.5);\r\n        }\r\n    }\r\n}\r\n\r\n"]}