{"version":3,"sources":["file:///E:/CocosCreator/git/mario/client/assets/script/game/ui/map/map.ts"],"names":["_decorator","Component","Node","UITransformComponent","PhysicsSystem2D","EPhysics2DDrawFlags","CCBoolean","AudioManager","clientEvent","Constant","roleManager","ccclass","property","map","mapName","start","node","name","instance","enable","isDebug","debugDrawFlags","All","_init","_addListener","playMusic","on","EVENT_TYPE","AddToMap","_evtAddToMap","obj","includes","mushroomLayer","addChild","addChildToMap","marioNode","getChildByName","onDestroy","off","CurMap","CurMapWidth","getComponent","width","Inst","init","addMarioToMap","addEnemyToMap","undefined"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;AAAWC,MAAAA,I,OAAAA,I;AAAsBC,MAAAA,oB,OAAAA,oB;AAAyDC,MAAAA,e,OAAAA,e;AAAiBC,MAAAA,mB,OAAAA,mB;AAAkCC,MAAAA,S,OAAAA,S;;AACzJC,MAAAA,Y,iBAAAA,Y;;AACAC,MAAAA,W,iBAAAA,W;;AACAC,MAAAA,Q,iBAAAA,Q;;AAEAC,MAAAA,W,iBAAAA,W;;;;;;;;;OACH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBZ,U;;qBAGjBa,G,WADZF,OAAO,CAAC,KAAD,C,UAEHC,QAAQ,CAACN,SAAD,C,UAERM,QAAQ,CAACV,IAAD,C,2BAJb,MACaW,GADb,SACyBZ,SADzB,CACmC;AAAA;AAAA;;AAAA;;AAAA;;AAAA,eAMxBa,OANwB,GAMP,EANO;AAAA;;AAQ/BC,QAAAA,KAAK,GAAG;AACJ,eAAKD,OAAL,GAAe,KAAKE,IAAL,CAAUC,IAAzB;AACAb,UAAAA,eAAe,CAACc,QAAhB,CAAyBC,MAAzB,GAAkC,IAAlC;;AACA,cAAI,KAAKC,OAAT,EAAkB;AACdhB,YAAAA,eAAe,CAACc,QAAhB,CAAyBG,cAAzB,GAA0ChB,mBAAmB,CAACiB,GAA9D;AACH;;AACD,eAAKC,KAAL;;AACA,eAAKC,YAAL;;AACA;AAAA;AAAA,4CAAaN,QAAb,CAAsBO,SAAtB,CAAgC,UAAhC,EAA2C,IAA3C;AACH;;AAEOD,QAAAA,YAAY,GAAG;AACnB;AAAA;AAAA,0CAAYE,EAAZ,CAAe;AAAA;AAAA,oCAASC,UAAT,CAAoBC,QAAnC,EAA6C,KAAKC,YAAlD,EAAgE,IAAhE;AACH;;AAEOA,QAAAA,YAAY,CAACC,GAAD,EAAY;AAC5B,cAAIA,GAAG,CAACb,IAAJ,CAASc,QAAT,CAAkB,UAAlB,CAAJ,EAAmC;AAC/B,iBAAKC,aAAL,CAAmBC,QAAnB,CAA4BH,GAA5B;AACH;AACJ;;AAEMI,QAAAA,aAAa,CAAClB,IAAD,EAAW;AAC3B,cAAGA,IAAI,CAACC,IAAL,CAAUc,QAAV,CAAmB,OAAnB,CAAH,EAA+B;AAC3B,gBAAII,SAAS,GAAG,KAAKnB,IAAL,CAAUoB,cAAV,CAAyB,WAAzB,CAAhB;;AACA,gBAAGD,SAAH,EAAa;AACTA,cAAAA,SAAS,CAACF,QAAV,CAAmBjB,IAAnB;AACA;AACH;AACJ;;AACD,eAAKA,IAAL,CAAUiB,QAAV,CAAmBjB,IAAnB;AACH;;AAEDqB,QAAAA,SAAS,GAAG;AACR;AAAA;AAAA,0CAAYC,GAAZ,CAAgB;AAAA;AAAA,oCAASX,UAAT,CAAoBC,QAApC,EAA8C,KAAKC,YAAnD,EAAiE,IAAjE;AACH;;AAEaN,QAAAA,KAAK,GAAG;AAAA;;AAAA;AAClB;AAAA;AAAA,sCAASgB,MAAT,GAAkB,KAAlB;AACA;AAAA;AAAA,sCAASC,WAAT,GAAuB,KAAI,CAACxB,IAAL,CAAUyB,YAAV,CAAuBtC,oBAAvB,EAA6CuC,KAApE;AACA;AAAA;AAAA,4CAAYC,IAAZ,CAAiBC,IAAjB,CAAsB,KAAtB;AACA;AAAA;AAAA,4CAAYD,IAAZ,CAAiBE,aAAjB;AACA;AAAA;AAAA,4CAAYF,IAAZ,CAAiBG,aAAjB;AALkB;AAOrB;;AAnD8B,O;;;;;iBAEZ,K;;;;;;;iBAEGC,S","sourcesContent":["import { _decorator, Component, Node, Vec3, director, UITransformComponent, view, v3, physics, Physics2DUtils, PhysicsSystem2D, EPhysics2DDrawFlags, instantiate, CCBoolean } from 'cc';\r\nimport { AudioManager } from '../../../framework/audioManager';\r\nimport { clientEvent } from '../../../framework/clientEvent';\r\nimport { Constant } from '../../../framework/constant';\r\nimport { resourceUtil } from '../../../framework/resourceUtil';\r\nimport { roleManager } from '../../roles/roleManager';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('map')\r\nexport class map extends Component {\r\n    @property(CCBoolean)\r\n    isDebug: boolean = false;\r\n    @property(Node)\r\n    mushroomLayer: Node = undefined;\r\n\r\n    public mapName:string = \"\";\r\n\r\n    start() {\r\n        this.mapName = this.node.name;\r\n        PhysicsSystem2D.instance.enable = true;\r\n        if (this.isDebug) {\r\n            PhysicsSystem2D.instance.debugDrawFlags = EPhysics2DDrawFlags.All;\r\n        }\r\n        this._init();\r\n        this._addListener();\r\n        AudioManager.instance.playMusic(\"mario_bg\",true);\r\n    }\r\n\r\n    private _addListener() {\r\n        clientEvent.on(Constant.EVENT_TYPE.AddToMap, this._evtAddToMap, this);\r\n    }\r\n\r\n    private _evtAddToMap(obj: Node) {\r\n        if (obj.name.includes(\"mushroom\")) {\r\n            this.mushroomLayer.addChild(obj);\r\n        }\r\n    }\r\n\r\n    public addChildToMap(node:Node){\r\n        if(node.name.includes(\"mario\")){\r\n            let marioNode = this.node.getChildByName(\"marioNode\");\r\n            if(marioNode){\r\n                marioNode.addChild(node);\r\n                return;\r\n            }\r\n        }\r\n        this.node.addChild(node);\r\n    }\r\n\r\n    onDestroy() {\r\n        clientEvent.off(Constant.EVENT_TYPE.AddToMap, this._evtAddToMap, this);\r\n    }\r\n\r\n    private async _init() {\r\n        Constant.CurMap = this;\r\n        Constant.CurMapWidth = this.node.getComponent(UITransformComponent).width;\r\n        roleManager.Inst.init(this);\r\n        roleManager.Inst.addMarioToMap();\r\n        roleManager.Inst.addEnemyToMap();\r\n\r\n    }\r\n}\r\n\r\n"]}