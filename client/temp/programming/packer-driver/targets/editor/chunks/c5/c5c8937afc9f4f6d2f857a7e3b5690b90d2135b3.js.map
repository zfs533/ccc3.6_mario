{"version":3,"sources":["file:///E:/CocosCreator/git/mario/client/assets/script/game/ui/map/camera.ts"],"names":["_decorator","Component","view","v3","Vec3","clientEvent","Constant","ccclass","property","camera","_winSize","getVisibleSize","_originPos","start","_init","_addListener","console","log","node","getPosition","on","EVENT_TYPE","MoveCamera","_evtMoveCamera","InitCameraPos","_evtInitCameraPos","StopCamera","_evtStopCamera","onDestroy","off","rolePos","_handleCameraPos","pos","dispatchEvent","MoveJoystick","params","gap","width","x","CurMapWidth","setPosition","y","z"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, view, v3, Vec3, TERRAIN_HEIGHT_BASE } from 'cc';\r\nimport { clientEvent } from '../../../framework/clientEvent';\r\nimport { Constant } from '../../../framework/constant';\r\nimport { roleManager } from '../../roles/roleManager';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('camera')\r\nexport class camera extends Component {\r\n\r\n    private _winSize = view.getVisibleSize();\r\n    private _originPos:Vec3 = new Vec3(0,0,1000);\r\n    start() {\r\n        this._init();\r\n        this._addListener();\r\n    }\r\n\r\n    private _init() {\r\n        console.log(\"camera pos: \"+this.node.getPosition());\r\n    }\r\n\r\n    private _addListener() {\r\n        clientEvent.on(Constant.EVENT_TYPE.MoveCamera, this._evtMoveCamera, this);\r\n        clientEvent.on(Constant.EVENT_TYPE.InitCameraPos, this._evtInitCameraPos, this);\r\n        clientEvent.on(Constant.EVENT_TYPE.StopCamera, this._evtStopCamera, this);\r\n    }\r\n\r\n    onDestroy() {\r\n        clientEvent.off(Constant.EVENT_TYPE.MoveCamera, this._evtMoveCamera, this);\r\n        clientEvent.off(Constant.EVENT_TYPE.InitCameraPos, this._evtInitCameraPos, this);\r\n        clientEvent.off(Constant.EVENT_TYPE.StopCamera, this._evtStopCamera, this);\r\n    }\r\n\r\n    /**\r\n     * 初始化摄像机位置,初始化顺序在角色登场之后\r\n     * @param rolePos \r\n     */\r\n    private _evtInitCameraPos(rolePos:Vec3){\r\n        this._handleCameraPos(rolePos);\r\n        let pos = this.node.getPosition();\r\n        clientEvent.dispatchEvent(Constant.EVENT_TYPE.MoveJoystick, pos);\r\n    }\r\n\r\n    /**\r\n     * 摄像机跟着角色移动\r\n     * @param params \r\n     */\r\n    private _evtMoveCamera(params: any[]) {\r\n        let rolePos = params[0];\r\n        this._handleCameraPos(rolePos);\r\n    }\r\n\r\n    private _handleCameraPos(rolePos:Vec3){\r\n        let pos = this.node.getPosition();\r\n        let gap = this._winSize.width/2;\r\n        if(pos.x>=0 && rolePos.x>=400){\r\n            pos.x = rolePos.x-gap+280;\r\n            if(pos.x>= Constant.CurMapWidth-this._winSize.width){\r\n                pos.x = Constant.CurMapWidth - this._winSize.width;\r\n            }\r\n            this.node.setPosition(pos);\r\n            clientEvent.dispatchEvent(Constant.EVENT_TYPE.MoveJoystick, pos);\r\n        }\r\n        else{\r\n            this.node.setPosition(v3(0,pos.y,pos.z));\r\n        }\r\n    }\r\n    \r\n    private _evtStopCamera() {\r\n\r\n    }\r\n}\r\n\r\n"]}