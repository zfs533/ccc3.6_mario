{"version":3,"sources":["file:///E:/CocosCreator/git/mario/client/assets/script/game/roles/enemy/enemyTortoise.ts"],"names":["_decorator","UITransform","Sprite","clientEvent","Constant","EnumEnemyStatus","resourceUtil","enemy","ccclass","property","enemyTortoise","_isDown","start","attactedNode","active","status","walk","refreshSpeedByStatus","scheduleOnce","data","getData","sp","getComponent","console","log","path","setSpriteIcon","onBeginContact","selfCollider","otherCollider","contact","isDeath","name1","node","name","name2","includes","y1","position","y","h2","height","y2","isColider","loadInsideTexture","run","stand","dispatchEvent","EVENT_TYPE","MarioDeath"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, Collider2D, UITransform, IPhysics2DContact, Sprite } from 'cc';\r\nimport { clientEvent } from '../../../framework/clientEvent';\r\nimport { Constant } from '../../../framework/constant';\r\nimport { EnumEnemyStatus } from '../../../framework/enum';\r\nimport { resourceUtil } from '../../../framework/resourceUtil';\r\nimport { enemy } from './enemy';\r\nconst { ccclass, property } = _decorator;\r\n/**\r\n * 普通乌龟\r\n */\r\n@ccclass('enemyTortoise')\r\nexport class enemyTortoise extends enemy {\r\n    private _isDown:boolean = false;\r\n    start(){\r\n        super.start();\r\n        if(this.attactedNode)this.attactedNode.active = false;\r\n        this.status = EnumEnemyStatus.walk;\r\n        this.refreshSpeedByStatus();\r\n        this.scheduleOnce(()=>{\r\n            if(this.attactedNode){\r\n                let data = this.getData();\r\n                let sp = this.attactedNode.getComponent(Sprite);\r\n                console.log(\"data.path \"+data.path);\r\n                resourceUtil.setSpriteIcon(data.path,sp,()=>{\r\n                    console.log(\"load finished11111\");\r\n                })\r\n            }\r\n        })\r\n    }\r\n\r\n    public onBeginContact(selfCollider: Collider2D, otherCollider: Collider2D, contact: IPhysics2DContact | null) {\r\n        super.onBeginContact(selfCollider, otherCollider, contact);\r\n        if (this.isDeath) return;\r\n        // 只在两个碰撞体开始接触时被调用一次\r\n        let name1 = selfCollider.node.name;\r\n        let name2 = otherCollider.node.name;\r\n        if (name2.includes(\"mario\")) {\r\n            let y1 = selfCollider.node.position.y;\r\n            let h2 = selfCollider.node.getComponent(UITransform).height;\r\n            y1 += h2;\r\n            let y2 = otherCollider.node.position.y\r\n            if (y2 >= y1 && !this.isColider) {//这里要动态加载被踩的图片\r\n                this.isColider = true;\r\n                this.scheduleOnce(()=>{this.isColider = false},0.1);\r\n                this.loadInsideTexture();\r\n                if(this.status == EnumEnemyStatus.walk || this.status == EnumEnemyStatus.run){\r\n                    this.status = EnumEnemyStatus.stand;\r\n                }\r\n                else if(this.status == EnumEnemyStatus.stand){\r\n                    this.status = EnumEnemyStatus.run;\r\n                }\r\n                this.refreshSpeedByStatus();\r\n            }\r\n            else if(y2 < y1){\r\n                clientEvent.dispatchEvent(Constant.EVENT_TYPE.MarioDeath);\r\n            }\r\n        }\r\n    }\r\n\r\n    private loadInsideTexture(){\r\n        if(this._isDown)return;\r\n        this._isDown = true;\r\n        let data = this.getData();\r\n        let sp = this.node.getComponent(Sprite);\r\n        console.log(\"data.path \"+data.path);\r\n        resourceUtil.setSpriteIcon(data.path,sp,()=>{\r\n            console.log(\"load finished\");\r\n        })\r\n    }\r\n}\r\n\r\n\r\n"]}