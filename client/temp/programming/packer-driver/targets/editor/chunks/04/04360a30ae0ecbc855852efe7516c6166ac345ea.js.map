{"version":3,"sources":["file:///E:/CocosCreator/mario/ccc3.6_mario/client/assets/script/game/ui/map/map.ts"],"names":["_decorator","Component","Node","UITransform","PhysicsSystem2D","EPhysics2DDrawFlags","CCBoolean","AudioManager","clientEvent","Constant","roleManager","ccclass","property","map","mapName","physicsStatus","start","node","name","_evtEnablePhysics","isDebug","instance","debugDrawFlags","All","_init","_addListener","playMusic","on","EVENT_TYPE","AddToMap","_evtAddToMap","EnablePhysics","obj","includes","mushroomLayer","addChild","addChildToMap","marioNode","getChildByName","onDestroy","off","CurMap","CurMapWidth","getComponent","width","Inst","init","addMarioToMap","addEnemyToMap","bool","enable","undefined"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, Vec3, director, UITransform, view, v3, physics, Physics2DUtils, PhysicsSystem2D, EPhysics2DDrawFlags, instantiate, CCBoolean } from 'cc';\r\nimport { AudioManager } from '../../../framework/audioManager';\r\nimport { clientEvent } from '../../../framework/clientEvent';\r\nimport { Constant } from '../../../framework/constant';\r\nimport { roleManager } from '../../roles/roleManager';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('map')\r\nexport class map extends Component {\r\n    @property(CCBoolean)\r\n    isDebug: boolean = false;\r\n    @property(Node)\r\n    mushroomLayer: Node = undefined;\r\n\r\n    public mapName:string = \"\";\r\n    public physicsStatus:boolean = true;\r\n\r\n    start() {\r\n        this.mapName = this.node.name;\r\n        this._evtEnablePhysics(true);\r\n        if (this.isDebug) {\r\n            PhysicsSystem2D.instance.debugDrawFlags = EPhysics2DDrawFlags.All;\r\n        }\r\n        this._init();\r\n        this._addListener();\r\n        AudioManager.instance.playMusic(\"mario_bg\",true);\r\n    }\r\n\r\n    private _addListener() {\r\n        clientEvent.on(Constant.EVENT_TYPE.AddToMap, this._evtAddToMap, this);\r\n        clientEvent.on(Constant.EVENT_TYPE.EnablePhysics, this._evtEnablePhysics, this);\r\n    }\r\n\r\n    private _evtAddToMap(obj: Node) {\r\n        if (obj.name.includes(\"mushroom\")) {\r\n            this.mushroomLayer.addChild(obj);\r\n        }\r\n    }\r\n\r\n    public addChildToMap(node:Node){\r\n        if(node.name.includes(\"mario\")){\r\n            let marioNode = this.node.getChildByName(\"marioNode\");\r\n            if(marioNode){\r\n                marioNode.addChild(node);\r\n                return;\r\n            }\r\n        }\r\n        this.node.addChild(node);\r\n    }\r\n\r\n    onDestroy() {\r\n        clientEvent.off(Constant.EVENT_TYPE.AddToMap, this._evtAddToMap, this);\r\n        clientEvent.off(Constant.EVENT_TYPE.EnablePhysics, this._evtEnablePhysics, this);\r\n    }\r\n\r\n    private async _init() {\r\n        Constant.CurMap = this;\r\n        Constant.CurMapWidth = this.node.getComponent(UITransform).width;\r\n        roleManager.Inst.init(this);\r\n        roleManager.Inst.addMarioToMap();\r\n        roleManager.Inst.addEnemyToMap();\r\n\r\n    }\r\n\r\n    _evtEnablePhysics(bool:boolean){\r\n        PhysicsSystem2D.instance.enable = bool;\r\n        this.physicsStatus = bool;\r\n    }\r\n}\r\n\r\n"]}