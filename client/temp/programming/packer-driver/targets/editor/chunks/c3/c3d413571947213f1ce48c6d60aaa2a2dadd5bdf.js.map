{"version":3,"sources":["file:///E:/CocosCreator/git/mario/client/assets/script/game/pieces/mushroom.ts"],"names":["_decorator","v3","tween","UITransform","RigidBody2D","BoxCollider2D","ERigidBody2DType","clientEvent","Constant","EnumPhysicsGroup","baseCollider","ccclass","property","mushroom","_speed","_normalX","_isActive","_group","start","_addListener","_init","setPhysicsGroup","on","EVENT_TYPE","MushRoomDestroy","_evtMushRoomDestroy","onDestroy","off","MoveSpeed","node","setScale","MapScale","bc","getComponent","group","_removePhysics","pos","getWorldPosition","height","setWorldPosition","x","y","z","to","worldPosition","call","_addPhysics","rb","type","Static","Dynamic","onBeginContact","selfCollider","otherCollider","contact","name1","name","name2","includes","normal","getWorldManifold","_evtMushroomMove","console","log","destroy","offset","update","deltaTime","CurMap","physicsStatus","getPosition","setPosition"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, Collider2D, IPhysics2DContact, v3, tween, UITransform, RigidBody2D, BoxCollider2D, math, ERigidBody2DType } from 'cc';\r\nimport { clientEvent } from '../../framework/clientEvent';\r\nimport { Constant } from '../../framework/constant';\r\nimport { EnumPhysicsGroup } from '../../framework/enum';\r\nimport { baseCollider } from '../collider/baseCollider';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('mushroom')\r\nexport class mushroom extends baseCollider {\r\n    private _speed: number = 1;\r\n    private _normalX: number = 0;\r\n    private _isActive: boolean = false;\r\n    private _group: number = 0;\r\n    start() {\r\n        super.start();\r\n        this._addListener();\r\n        this._init();\r\n        this.setPhysicsGroup(EnumPhysicsGroup.mushroom);\r\n        clientEvent.on(Constant.EVENT_TYPE.MushRoomDestroy,this._evtMushRoomDestroy,this);\r\n    }\r\n    private _addListener() {\r\n    }\r\n\r\n    onDestroy() {\r\n        clientEvent.off(Constant.EVENT_TYPE.MushRoomDestroy,this._evtMushRoomDestroy,this);\r\n    }\r\n\r\n    private _init() {\r\n        this._speed = Constant.MoveSpeed / 3;\r\n        this.node.setScale(v3(Constant.MapScale, Constant.MapScale, 1));\r\n        let bc = this.node.getComponent(BoxCollider2D);\r\n        this._group = bc.group;\r\n        this._removePhysics();\r\n        let pos = this.node.getWorldPosition();\r\n        let height = this.node.getComponent(UITransform).height * Constant.MapScale;\r\n        this.node.setWorldPosition(v3(pos.x, pos.y - (height / Constant.MapScale), pos.z));\r\n        pos = this.node.getWorldPosition();\r\n        this.node.setWorldPosition(v3(pos.x, pos.y - (height), pos.z))\r\n        // this.node.setSiblingIndex(3);\r\n\r\n        tween(this.node).to(1, { worldPosition: v3(pos.x, pos.y, pos.z) }).call(() => {\r\n            this._addPhysics();\r\n        }).start();\r\n    }\r\n\r\n    private _removePhysics() {\r\n        let rb = this.node.getComponent(RigidBody2D);\r\n        rb.type = ERigidBody2DType.Static;\r\n    }\r\n\r\n    private _addPhysics() {\r\n        let rb = this.node.getComponent(RigidBody2D);\r\n        rb.type = ERigidBody2DType.Dynamic;\r\n        this._isActive = true;\r\n    }\r\n\r\n    public onBeginContact(selfCollider: Collider2D, otherCollider: Collider2D, contact: IPhysics2DContact | null) {\r\n        // 只在两个碰撞体开始接触时被调用一次\r\n        let name1 = selfCollider.node.name;\r\n        let name2 = otherCollider.node.name;\r\n        if (name1.includes(\"mushroom\")) {\r\n            let normal = contact.getWorldManifold().normal;\r\n            this._evtMushroomMove(normal.x);\r\n        }\r\n        if(name2.includes(\"mario\")){\r\n            this.node.setScale(v3(0,0,0))\r\n        }\r\n    }\r\n\r\n    _evtMushRoomDestroy(){\r\n\r\n        console.log(\"-------------- destroy --------------\")\r\n        this.node.destroy();\r\n    }\r\n\r\n    private _evtMushroomMove(offset: number) {\r\n        if (offset != this._normalX) {\r\n            this._speed *= -1;\r\n            this._normalX = offset;\r\n        }\r\n    }\r\n\r\n    update(deltaTime: number) {\r\n        if (!this._isActive || !Constant.CurMap.physicsStatus) return;\r\n        let pos = this.node.getPosition();\r\n        pos.x += this._speed;\r\n        this.node.setPosition(pos);\r\n    }\r\n}\r\n\r\n"]}